!function(){angular.module("SourceEditor",["EavConfiguration","EavServices","SxcServices","SxcTemplates","pascalprecht.translate","ui.ace"]).config(["$translatePartialLoaderProvider",function(a){a.addPart("source-editor-snippets")}])}(),angular.module("SourceEditor").component("devFiles",{templateUrl:"source-editor/dev-files.html",controller:["appAssetsSvc","appId",function(a,b){var c=angular.extend(this,{show:!1,svc:a(b),toggle:function(){c.show=!c.show,c.assets||(c.assets=c.svc.liveList())},editFile:function(a){window.open(c.assembleUrl(a)),c.toggle()},assembleUrl:function(a){var b=window.location.href,c=JSON.stringify([{Path:a}]);return b.replace(new RegExp("items=.*?%5d","i"),"items="+encodeURI(c))},addFile:function(){var a=prompt("please enter full file name");a&&c.svc.create(a)}})}],controllerAs:"vm",bindings:{fileName:"<",type:"<"}}),function(){function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){l(function(){p.save(!1)})}var o=f[0];j.refresh();var p=this;p.debug=m;var q=a(void 0!==o.EntityId?o.EntityId:o.Path);p.view={},p.tempCodeBecauseOfBug="",p.editor=null,q.get().then(function(a){p.view=a.data,q.initSnippets(p.view)}),q.initSnippets=function(a){p.snipSvc=b(a,ace),p.snipSvc.getSnippets().then(function(a){p.snippets=a,p.registerSnippets()})},p.close=function(){confirm(j.instant("Message.ExitOk"))&&window.close()},i.$on("modal.closing",function(a){a.preventDefault()}),h.addEventListener("beforeunload",function(a){var b=j.instant("Message.ExitOk");return(a||window.event).returnValue=b,b}),p.save=function(a){var b=a?p.close:function(){},c=p.editor.getValue(),d=angular.copy(p.view);d.Code!==c&&(d.Code=c),k(q.save(d)).then(b)},n(),p.registerSnippets=function(){p.snipSvc&&p.editor&&p.snipSvc.registerInEditor()},p.aceLoaded=function(a){p.editor=a,p.registerSnippets()}}angular.module("SourceEditor").component("editor",{templateUrl:"source-editor/editor.html",controller:a,controllerAs:"vm"}),a.$inject=["sourceSvc","snippetSvc","appAssetsSvc","appId","sxcDialogs","items","$uibModalInstance","$window","$scope","$translate","saveToastr","ctrlS","debugState"]}(),angular.module("SourceEditor").component("snippetsLinks",{templateUrl:"source-editor/snippets-links.html",controller:function(){},controllerAs:"vm",bindings:{links:"<"}}),angular.module("SourceEditor").component("snippets",{templateUrl:"source-editor/snippets.html",controller:function(){var a=this;a.snippetSet="Content",a.addSnippet=function(b){var c=ace.require("ace/snippets").snippetManager;c.insertSnippet(a.editor,b),a.editor.focus()},a.$onInit=function(){console.log("component snip loading"),console.log("def set"+a.snippetSet)},a.$onChanges=function(){console.log("def set"+a.snippetSet)}},controllerAs:"vm",bindings:{snippets:"<",editor:"<"}}),angular.module("SourceEditor").factory("snippetSvc",["$http","eavConfig","svcCreator","$translate","contentTypeFieldSvc","$q",function(a,b,c,d,e,f){function g(){var a={inputTypeSnippets:{},extractInputTypeSnippets:function(b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e],g="\\"===f.set[0];g?(f.set=f.set.substr(1),d.push(f)):c.push(f)}a.inputTypeSnippets=a.catalogInputTypeSnippets(d)},catalogInputTypeSnippets:function(a){for(var b={},c=0;c<a.length;c++)void 0===b[a[c].subset]&&(b[a[c].subset]=[]),b[a[c].subset].push(a[c]);return b},attachSnippets:function(b,c,d,e,f){var g=a.inputTypeSnippets[e];if(e.indexOf("-")){var h=e.substr(0,e.indexOf("-"));if(h){var i=a.inputTypeSnippets[h];i&&(g=g?g.concat(i):i)}}if(g){void 0===b[d].more&&(b[d].more=[]);for(var j=b[d].more,k=0;k<g.length;k++)try{j[d+"-"+g[k].name]=angular.extend({},f,{key:d+" - "+g[k].name,label:g[k].name,snip:a.localizeGenericSnippet(g[k].content,c,d),collapse:!0})}finally{}}},localizeGenericSnippet:function(a,b,c){return a=a.replace(/(\$\{[0-9]+\:)var(\})/gi,"$1"+b+"$2").replace(/(\$\{[0-9]+\:)prop(\})/gi,"$1"+c+"$2")}};return a}return function(b,c){var h={cachedSnippets:{},inputTypes:g(),loaded:!1,list:[],tree:null,ace:c,getSnippets:function(){return h.loaded?f(function(a,b){a(h.cachedSnippets)}):h.loadTable().then(function(a){var b=h.filterAwayNotNeededSnippetsList(a.data.snippets);h.inputTypes.extractInputTypeSnippets(b,h.list);var c=h.initSnippetsWithConfig(h.list);for(var d in c)h.cachedSnippets[d]=c[d];return h.loaded=!0,h.cachedSnippets})},initSnippetsWithConfig:function(a){return a=h.tree=h.makeTree(a),a.Content=angular.extend({},a.Content,{Fields:{},PresentationFields:{}}),b.TypeContent&&h.loadContentType(a.Content.Fields,b.TypeContent,"Content"),b.TypeContentPresentation&&h.loadContentType(a.Content.PresentationFields,b.TypeContentPresentation,"Content.Presentation"),b.HasList?(a.List=angular.extend({},a.List,{Fields:{},PresentationFields:{}}),b.TypeList&&h.loadContentType(a.List.Fields,b.TypeList,"ListContent"),b.TypeListPresentation&&h.loadContentType(a.List.PresentationFields,b.TypeListPresentation,"ListContent.Presentation")):delete a.List,b.HasApp&&(a.App.Resources={},a.App.Settings={},h.loadContentType(a.App.Resources,"App-Resources","App.Resources"),h.loadContentType(a.App.Settings,"App-Settings","App.Settings")),h.cachedSnippets=a,a},loadTable:function(){return a.get("../sxc-develop/snippets.json.js")},makeTree:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];void 0===b[d.set]&&(b[d.set]={}),void 0===b[d.set][d.subset]&&(b[d.set][d.subset]=[]);var e={key:d.name,label:h.label(d.set,d.subset,d.name),snip:d.content,help:d.help||h.help(d.set,d.subset,d.name),links:h.linksList(d.links)};b[d.set][d.subset].push(e)}return b},linksList:function(a){if(!a)return null;for(var b=[],c=a.split("n"),d=0;d<c.length;d++){var e=c[d].split(":");3===e.length&&b.push({name:e[0].trim(),url:e[1].trim()+":"+e[2].trim()})}return 0===b.length?null:b},help:function(a,b,c){var e=h.getHelpKey(a,b,c,".Help"),f=d.instant(e);return f===e&&(f=""),f},label:function(a,b,c){var e=h.getHelpKey(a,b,c,".Key"),f=d.instant(e);return f===e&&(f=c),f},getHelpKey:function(a,b,c,d){return"SourceEditorSnippets."+a+"."+b+"."+c+d},filterAwayNotNeededSnippetsList:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=h.keyPrefixes.indexOf(d.set[0]);(-1===e||e===h.keyPrefixIndex)&&(e===h.keyPrefixIndex&&(d.set=d.set.substr(1)),b.push(d))}return b},keyPrefixes:["@","["],keyPrefixIndex:b.Type.indexOf("Razor")>-1?0:1,loadContentType:function(a,c,f){e(b.AppId,{StaticName:c}).getFields().then(function(b){angular.forEach(b.data,function(b){var c=b.StaticName;a[c]={key:c,label:c,snip:h.valuePlaceholder(f,c),help:b.Metadata.merged.Notes||" ("+b.Type.toLowerCase()+") "};var d=angular.copy(a[c]);h.inputTypes.attachSnippets(a,f,c,b.InputType,d)});var c=["EntityId","EntityTitle","EntityGuid","EntityType","IsPublished","Modified"];if(b.data.length)for(var e=0;e<c.length;e++)a[c[e]]={key:c[e],label:c[e],snip:h.valuePlaceholder(f,c[e]),help:d.instant("SourceEditorSnippets.StandardFields."+c[e]+".Help")}})},valuePlaceholder:function(a,c){return b.Type.indexOf("Razor")>-1?"@"+a+"."+c:"["+a.replace(".",":")+":"+c+"]"},registerInEditor:function(){if(null===h.list)throw"can't register snippets because list is not loaded";var a=c.require("ace/snippets").snippetManager;a.register(h.list)}};return h}}]),angular.module("SourceEditor").factory("sourceSvc",["$http",function(a){return function(b){var c=isNaN(b)?{path:b}:{templateId:b},d={get:function(){return a.get("app/appassets/asset",{params:c}).then(function(a){var b=a.data;if("auto"===b.Type.toLowerCase())switch(b.Extension.toLowerCase()){case".cs":case".cshtml":b.Type="Razor";break;case".html":case".css":case".js":b.Type="Token"}return a})},save:function(b){return a.post("app/appassets/asset",b,{params:c})}};return d}}]),function(){angular.module("SourceEditor").filter("toArray",function(){return function(a,b){return angular.isObject(a)?b===!1?Object.keys(a).map(function(b){return a[b]}):Object.keys(a).map(function(b){var c=a[b];return angular.isObject(c)?Object.defineProperty(c,"$key",{enumerable:!1,value:b}):{$key:b,$value:c}}):a}})}(),angular.module("SourceEditor").run(["$templateCache",function(a){"use strict";a.put("source-editor/dev-files.html",'<div uib-tooltip="{{ vm.fileName }}" ng-click=vm.toggle()>{{ vm.fileName.substr(vm.fileName.lastIndexOf("\\\\") + 1) }} ({{vm.type }}) <i ng-class="{&quot;icon-eav-plus-squared&quot;: !vm.show, &quot;icon-eav-minus-squared&quot;: vm.show}"></i></div><div ng-if=vm.show><h4>quick-pick another file</h4><ol><li ng-repeat="asset in vm.assets" ng-click=vm.editFile(asset)>{{asset}}</li></ol><ul><li ng-click=vm.addFile()>create file <span class=icon-eav-plus-circled></span></li><li>for copy, rename etc. please use the dnn file manager</li></ul></div>'),a.put("source-editor/editor.html","<div ng-click=vm.debug.autoEnableAsNeeded($event)><div class=modal-header><h3 class=modal-title translate=SourceEditor.Title></h3></div><div class=modal-body><div class=row><div class=col-md-8><dev-files file-name=vm.view.FileName type=vm.view.Type></dev-files><div ng-model=vm.view.Code style=\"height: 600px\" ui-ace=\"{\r\n                    useWrapMode : true,\r\n                    useSoftTabs: true,\r\n                    showGutter: true,\r\n                    theme:'sqlserver',\r\n                    mode: 'razor',\r\n                    onLoad: vm.aceLoaded,\r\n                    require: ['ace/ext/language_tools', '//xyz/something'],\r\n                    advanced: {\r\n                        enableSnippets: true,\r\n                        enableBasicAutocompletion: true,\r\n                        enableLiveAutocompletion: true\r\n                    },\r\n                    rendererOptions: {\r\n                        fontSize: 16\r\n                    }\r\n                }\"></div></div><div class=\"pull-right col-md-4\"><snippets ng-if=vm.snippets snippets=vm.snippets editor=vm.editor></snippets></div></div></div><div class=modal-footer><div class=pull-left><button class=\"btn btn-primary btn-lg xxbtn-square\" type=button ng-click=vm.save(false)><span icon=check uib-tooltip=\"{{ 'Button.SaveAndKeepOpen' | translate }}\"></span> {{ 'Button.SaveAndKeepOpen' | translate }}</button> also supports Ctrl+S</div></div><show-debug-availability class=pull-right></show-debug-availability><div ng-if=vm.debug.on><pre>{{vm.view.Code}}</pre></div></div><style>/* helper to ensure that razor (which is correctly detected by ACE) is also highlighted */\r\n    .ace_razor {\r\n        background-color: yellow;\r\n    }\r\n\r\n    /* make sure the highlighted text is also black, otherwise it a kind of gray */\r\n    .ace_punctuation.ace_short.ace_razor {\r\n        color: black;\r\n    }\r\n\r\n    .ace_punctuation.ace_block.ace_razor {\r\n        color: black;\r\n    }</style>"),a.put("source-editor/snippets-links.html",'<div><div ng-repeat="link in vm.links">&gt; <a href={{link.url}} target=_blank>{{link.name}}</a></div></div>'),a.put("source-editor/snippets.html",'<div><strong translate=SourceEditor.SnippetsSection.Title></strong> <i icon=question-sign style="opacity: 0.3" ng-click="showSnippetInfo = !showSnippetInfo"></i><div ng-if=showSnippetInfo translate=SourceEditor.SnippetsSection.Intro></div></div><select class=input-lg style="width: 90%" ng-model=vm.snippetSet ng-options="key as (\'SourceEditorSnippets.\' + key + \'.Title\' | translate) for (key , value) in vm.snippets" uib-tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.Help\'  | translate}}"></select><div>&nbsp;</div><div style="height: 500px; overflow: auto"><div ng-repeat="(subsetName, subsetValue) in vm.snippets[vm.snippetSet]"><strong uib-tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Help\'  | translate}}">{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Title\' | translate}}</strong><ul><li ng-repeat="value in subsetValue | toArray | orderBy: \'$key\'" uib-tooltip="{{ value.snip }}"><span ng-mouseover="showAdd = true" ng-click="show = !show" ng-mouseout="showAdd = false"><i class=icon-eav-plus-squared ng-click=vm.addSnippet(value.snip) ng-show=showAdd stop-event=click></i> {{value.label}} <i icon=info-sign style="opacity: 0.3" ng-show=value.help></i> <a ng-show=value.more ng-click="showMore = !showMore" stop-event=click><i icon=plus></i>more</a></span><div ng-if=show><em>{{value.help}}</em><snippets-links links=value.links ng-if=value.links></snippets-links></div><ul ng-if=showMore><li ng-repeat="more in value.more | toArray | orderBy: \'$key\'" uib-tooltip="{{ value.snip }}"><span ng-click=vm.addSnippet(more.snip)>{{more.label}}</span> <i icon=info-sign style="opacity: 0.3" ng-click="show = !show" ng-show=more.help></i><div ng-if=show><em>{{more.help}}</em><snippets-links links=more.links ng-if=more.links></snippets-links></div></li></ul></li></ul></div></div>')}]);
//# sourceMappingURL=sxc-develop.min.js.map