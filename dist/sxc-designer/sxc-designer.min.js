/*! ToSic_ToSxc 2015-12-26 */

!function(){angular.module("SourceEditor",["EavConfiguration","EavServices","SxcServices","SxcTemplates","pascalprecht.translate","ui.ace"]).config(["$translatePartialLoaderProvider",function(a){a.addPart("source-editor-snippets")}])}(),function(){function a(a,b,c,d,e,f){f.refresh();var g=this,h=a(c.EntityId);g.view={},g.editor=null,h.get().then(function(a){g.view=a.data,h.initSnippets(g.view)}),h.initSnippets=function(a){g.snipSvc=b(a,ace),g.snipSvc.getSnippets().then(function(a){g.snippets=a,g.snippetSet="Content",g.snippetHelp=g.snipSvc.help,g.snippetLabel=g.snipSvc.label,g.registerSnippets()})},g.close=function(){d.dismiss("cancel")},g.save=function(){h.save(g.view).then(g.close)},g.addSnippet=function(a){var b=ace.require("ace/snippets").snippetManager;b.insertSnippet(g.editor,a),g.editor.focus()},g.registerSnippets=function(){g.snipSvc&&g.editor&&g.snipSvc.registerInEditor()},e.aceLoaded=function(a){g.editor=a,g.registerSnippets()}}angular.module("SourceEditor").controller("Editor",a),a.$inject=["sourceSvc","snippetSvc","item","$modalInstance","$scope","$translate"]}(),function(){angular.module("SourceEditor").constant("snippets",{tokens:'# Some useful 2sxc tags / placeholders \n# toolbar\nsnippet toolbar \nkey Toolbar \ntitle Toolbar \nhelp Toolbar for inline editing with 2sxc. If used inside a <div class="sc-element"> then the toolbar will automatically float \n	[${1:Content}:Toolbar]\n',html:"",razor:"# Some useful 2sxc tags / placeholders \n#######################\n### Razor App stuff\n# path\nset app\ntitle Path \nhelp returns the url to the current app, for integrating scripts, images etc. For example, use as ***/scripts/knockout.js\nsnippet path \n	@App.Path\n# physical path\nset app\ntitle Physical path \nhelp physical path, in c:\\\nsnippet physical path \n	@App.PhysicalPath\n# App Guid \nset app\ntitle App Guid \nhelp internal GUID - should stay the same across all systems for this specific App \nsnippet app guid \n	@App.AppGuid\n# App Id \nset app\ntitle App Id \nhelp Id in the current data base. Is a different number in every App-Installation \nsnippet app id \n	@App.AppId\n# App Name \nset app\ntitle App Name \nhelp internal name \nsnippet app name \n	@App.Name\n# App Folder \nset app\ntitle App Folder \nhelp folder of the 2sxc-app, often used to create paths to scripts or join some values. if you only need to reference a script, please use App.Path \nsnippet app folder \n	@App.Folder\n            ",razor2:{App:[{key:"path",title:"Path",help:"returns the url to the current app, for integrating scripts, images etc. For example, use as ***/scripts/knockout.js",snippet:"path",content:"@App.Path"},{key:"physical path",title:"Physical path",help:"physical path, in c:\\",snippet:"physical path",content:"@App.PhysicalPath"},{key:"App Guid",title:"App Guid",help:"internal GUID - should stay the same across all systems for this specific App",snippet:"app guid",content:"@App.AppGuid"},{key:"App Id",title:"App Id",help:"Id in the current data base. Is a different number in every App-Installation",snippet:"app id",content:"@App.AppId"},{key:"App Name",title:"App Name",help:"internal name",snippet:"app name",content:"@App.Name"},{key:"App Folder",title:"App Folder",help:"folder of the 2sxc-app, often used to create paths to scripts or join some values. if you only need to reference a script, please use App.Path",snippet:"app folder",content:"@App.Folder"}]}})}(),angular.module("SourceEditor").factory("snippetSvc",["$http","eavConfig","svcCreator","$translate","contentTypeFieldSvc","$q",function(a,b,c,d,e,f){return function(b,c){var g={cachedSnippets:{},loaded:!1,list:null,tree:null,ace:c,getSnippets:function(){return g.loaded?f(function(a,b){a(g.cachedSnippets)}):g.loadTable().then(function(a){g.list=g.filterAwayNotNeededSnippetsList(a.data.snippets);var b=g.initSnippetsWithConfig(g.list);for(var c in b)g.cachedSnippets[c]=b[c];return g.loaded=!0,g.cachedSnippets})},initSnippetsWithConfig:function(a){return a=g.tree=g.makeTree(a),a.Content={Fields:{},PresentationFields:{}},b.HasList&&(a.List={Fields:{},PresentationFields:{}}),b.HasApp&&(a.App={Resources:{},Settings:{}}),b.TypeContent&&g.loadContentType(a.Content.Fields,b.TypeContent,"Content"),b.TypeContentPresentation&&g.loadContentType(a.Content.PresentationFields,b.TypeContentPresentation,"Content.Presentation"),b.TypeList&&g.loadContentType(a.List.Fields,b.TypeList,"List"),b.TypeListPresentation&&g.loadContentType(a.List.PresentationFields,b.TypeListPresentation,"List.Presentation"),b.HasApp&&(g.loadContentType(a.App.Resources,"App-Resources","App.Resources"),g.loadContentType(a.App.Settings,"App-Settings","App.Settings")),g.cachedSnippets=a,a},loadTable:function(){return a.get("../sxc-designer/snippets.json.js")},makeTree:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];void 0===b[d.set]&&(b[d.set]={}),void 0===b[d.set][d.subset]&&(b[d.set][d.subset]=[]);var e={key:d.name,label:g.label(d.set,d.subset,d.name),snip:d.content,help:d.help||g.help(d.set,d.subset,d.name)};b[d.set][d.subset].push(e)}return b},help:function(a,b,c){var e=g.getHelpKey(a,b,c,".Help"),f=d.instant(e);return f===e&&(f=""),f},label:function(a,b,c){var e=g.getHelpKey(a,b,c,".Key"),f=d.instant(e);return f===e&&(f=c),f},getHelpKey:function(a,b,c,d){var e="SourceEditorSnippets",f=e+"."+a+"."+b+"."+c;return f+=d},traverse:function(a,b){for(var c in a)a.hasOwnProperty(c)&&(b.apply(this,[a,c,a[c]]),null!==a[c]&&"object"==typeof a[c]&&g.traverse(a[c],b))},filterAwayNotNeededSnippetsList:function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=g.keyPrefixes.indexOf(d.set[0]);(-1===e||e===g.keyPrefixIndex)&&(b.push(d),e===g.keyPrefixIndex&&(d.set=d.set.substr(1)))}return b},filterAwayNotNeededSnippetsTree:function(a,b,c){var d=b[0],e=g.keyPrefixes.indexOf(d);if(delete a[b],-1!==e){if(d!==g.allowedKeyPrefix)return;b=b.substr(1)}a[b]=c},keyPrefixes:["@","["],keyPrefixIndex:b.Type.indexOf("Razor")>-1?0:1,allowedKeyPrefix:b.Type.indexOf("Razor")>-1?"@":"[",loadContentType:function(a,c,f){e(b.AppId,{StaticName:c}).getFields().then(function(b){angular.forEach(b.data,function(b){var c=b.StaticName,d=b.Metadata.merged.Notes||" ("+b.Type.toLowerCase()+") ",e=g.valuePlaceholder(f,c);a[c]={key:c,label:c,snip:e,help:d}});var c=["EntityId","EntityTitle","EntityGuid","EntityType","IsPublished","Modified"];if(b.data.length)for(var e=0;e<c.length;e++)a[c[e]]={key:c[e],label:c[e],snip:g.valuePlaceholder(f,c[e]),help:d.instant("SourceEditorSnippets.StandardFields."+c[e]+".Help")}})},valuePlaceholder:function(a,c){return b.Type.indexOf("Razor")>-1?"@"+a+"."+c:"["+a.replace(".",":")+":"+c+"]"},registerInEditor:function(){var a=c.require("ace/snippets").snippetManager;a.register(g.list)}};return g}}]),angular.module("SourceEditor").factory("sourceSvc",["$http",function(a){return function(b){var c={get:function(){return a.get("view/template/template",{params:{templateId:b}})},save:function(c){return a.post("view/template/template",c,{params:{templateId:b}})}};return c}}]),function(){angular.module("SourceEditor").filter("toArray",function(){return function(a,b){return angular.isObject(a)?b===!1?Object.keys(a).map(function(b){return a[b]}):Object.keys(a).map(function(b){var c=a[b];return angular.isObject(c)?Object.defineProperty(c,"$key",{enumerable:!1,value:b}):{$key:b,$value:c}}):a}})}(),angular.module("SourceEditor").run(["$templateCache",function(a){"use strict";a.put("source-editor/editor.html",'<div ng-click=vm.debug.autoEnableAsNeeded($event)><div class=modal-header><button class="btn btn-default btn-square btn-subtle pull-right" type=button ng-click=vm.close()><i icon=remove></i></button><h3 class=modal-title translate=SourceEditor.Title></h3></div><div class=modal-body><div class=row><div class=col-md-8><div tooltip="{{ vm.view.FileName }}">{{ vm.view.FileName.substr(vm.view.FileName.lastIndexOf("\\\\") + 1) }} ({{vm.view.Type }})</div><div ng-model=vm.view.Code style="height: 400px" ui-ace="{\r\n                    useWrapMode : true,\r\n                    useSoftTabs: true,\r\n                    showGutter: true,\r\n                    theme:\'twilight\',\r\n                    mode: \'html\',\r\n                    onLoad: aceLoaded,\r\n                    require: [\'ace/ext/language_tools\'],\r\n                    advanced: {\r\n                        enableSnippets: true,\r\n                        enableBasicAutocompletion: true,\r\n                        enableLiveAutocompletion: true\r\n                    }}"></div></div><div class="pull-right col-md-4"><div><strong translate=SourceEditor.SnippetsSection.Title></strong> <i icon=question-sign style="opacity: 0.3" ng-click="showSnippetInfo = !showSnippetInfo"></i><div ng-if=showSnippetInfo translate=SourceEditor.SnippetsSection.Intro></div></div><select class=input-lg width=100% ng-model=vm.snippetSet ng-options="key as (\'SourceEditorSnippets.\' + key + \'.Title\' | translate) for (key , value) in vm.snippets" tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.Help\'  | translate}}"></select><div>&nbsp;</div><div ng-repeat="(subsetName, subsetValue) in vm.snippets[vm.snippetSet]"><strong tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Help\'  | translate}}">{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Title\' | translate}}</strong><ul><li ng-repeat="value in subsetValue | toArray | orderBy: \'$key\'" tooltip="{{ value.snip }}"><span ng-click=vm.addSnippet(value.snip)>{{value.label}}</span> <i icon=info-sign style="opacity: 0.3" ng-click="show = !show" ng-show=value.help></i><div ng-if=show><em>{{value.help}}</em></div></li></ul></div></div></div></div><div class=modal-footer><button class="btn btn-primary btn-square btn-lg pull-left" type=button ng-click=vm.save()><i icon=ok></i></button></div><show-debug-availability class=pull-right></show-debug-availability></div>')}]);
//# sourceMappingURL=sxc-designer.min.js.map