<!DOCTYPE html>
<html>
<head>
    <title>Content Editing UI</title>
    <meta charset="utf-8" />
    <!-- first load the main 2sxc because it contains some url-param methods -->
    <script src="../../js/2sxc.api.min.js"></script>
    <script>
        // this creates an object on $.ServicesFramework
        // it looks like the DNN object and is necessary so that scripts relying on it will work
        // it basically fakes it, but contains the correct infos like getTabId etc. without needing the full DNN
        function createFakeSf(apiUrl) {
            if (window.$ === undefined)
                window.$ = {};
            var dollar = window.$;
            var modId = $2sxc.urlParams.require("mid");
            if (modId === "")
                alert("ModuleId (mid) missing - cannot continue");
            dollar.ServicesFramework = function (id) {
                return {
                    name: "This is a fake DNN ServicesFramework",
                    description: "It enables stuff to work which thinks it needs this, but doesn't really",
                    getTabId: function () { return $2sxc.urlParams.require("tid"); },
                    getAntiForgeryValue: function () { return "abcdefgihjklmnop"; },
                    getServiceRoot: function () { return apiUrl; }
                }
            }
        }

        // add a script right then and there to the document
        function addScript(src) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = src;
            document.write(script.outerHTML); // needs doc.write to ensure in-sync loading of the files
        }

        // add a style to the document header
        function addStyle(src) {
            var style = document.createElement("link");
            style.setAttribute("rel", "stylesheet");
            style.setAttribute("type", "text/css");
            style.setAttribute("href", src);
            document.getElementsByTagName('head')[0].appendChild(style);
        }

    </script>


    <script>
        // check if we must load jquery - if we do, it has to happen very early!
        var dialogName = $2sxc.urlParams.require("dialog");

        // Functionality only needed by the pipeline designers - then it will also load jQuery, otherwise not
        if (dialogName === "pipeline-designer") {
            addScript("../lib/pipeline/jq.min.js");
            addScript("../lib/pipeline/set.min.js");
            addStyle("../admin/pipeline-designer.min.css");
        }
    </script>


    <!--default set needed for all UIs like angular, animate, translate-->
    <script src="../lib/angular/set.min.js"></script>

    <!--2sxc stuff like bootloader, configuration-->
    <script src="../../js/angularjs/2sxc4ng.min.js"></script>
    <script src="../config/config.js"></script>

    <!--Main parts like eav-admin, sxc-admin and eav-edit--> 
    <script src="../admin/eav-admin.js"></script>
    <script src="../sxc-admin/sxc-admin.js"></script>
    <script src="../edit/eav-edit.js"></script>
    <script src="../sxc-edit/sxc-edit.js"></script>


    <!-- style sheets -->
    <link rel="stylesheet" type="text/css" href="../lib/angular/set.min.css"/>
    <link rel="stylesheet" type="text/css" href="../admin/eav-admin.min.css"/>
    <link rel="stylesheet" type="text/css" href="../edit/edit.min.css" />

    <script>
        // this must come close to the end, after a closed script which might load jQuery
        var apiUrl = window.location.pathname.substring(0, window.location.pathname.toLowerCase().indexOf("desktopmodules"))
            + "desktopmodules/2sxc/api/";
        createFakeSf(apiUrl);
    </script>
</head>
<body style="background-color:transparent">

    <script>
        // note: the pipeline designer is special - it doesn't open a modal-dialog
        // ...but should be shown directly
        // all others will be modal-opened by the DialogHost App
        if (dialogName !== "pipeline-designer")
            document.write('<div sxc-app="DialogHost" ng-dependencies="InitParametersFromUrl,InitSxcParametersFromUrl,DialogHost" ng-controller="DialogHost as vm"></div>');
        else {
            document.write('<div sxc-app="PipelineDesigner" ng-include="\'pipelines/pipeline-designer.html\'" ng-dependencies="InitParametersFromUrl,InitSxcParametersFromUrl,PipelineDesigner"></div>');
        }
    </script>

</body>
</html>