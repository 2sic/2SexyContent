/*! ToSic_ToSxc 2015-09-21 */

!function(){"use strict";var a=angular.module("SxcEditContentGroupDnnWrapper",["sxcEditContentGroup"]);a.controller("editContentGroupDnnWrapperCtrl",["entityId","typeName","groupGuid","groupIndex",function(a,b,c,d){var e=this;e.edit={entityId:a,contentTypeName:b,contentGroupGuid:c,sortOrder:d}}])}(),function(){"use strict";var a=angular.module("sxcEditContentGroup",["eavEditEntity","eavLocalization","sxcFieldTemplates","SxcEditTemplates","sxcEditContentGroupSvc"]);a.directive("editContentGroup",function(){return{templateUrl:"edit-entity-or-contentgroup.html",restrict:"E",scope:{edit:"=edit"},controller:"editContentGroupCtrl",controllerAs:"vm"}}),a.controller("editContentGroupCtrl",["$q","$scope","sxcContentGroupService",function(a,b,c){var d=this;d.entitiesToEdit=[];var e=b.edit.entityId,f=b.edit.contentTypeName,g=b.edit.contentGroupGuid,h=b.edit.sortOrder;g&&c.get(g).then(function(a){var b=a.data;b.Template||alert("No template defined"),console.log(a);var c=-1==h?["ListContent","ListPresentation"]:["Content","Presentation"];-1==h&&(h=0),angular.forEach(c,function(a,c){var e=b.Template[a+"TypeStaticName"],f={contentTypeName:e,entityId:b[a][h],editControlTitle:a};-1!=a.indexOf("Presentation")&&(f.isPresentation=!0),f.isPresentation&&!f.entityId&&(f.useDefaultValues=!0),e&&d.entitiesToEdit.push(f)}),console.log(d.entitiesToEdit)}),e?d.entitiesToEdit.push({entityId:e,editControlTitle:"Entity"}):f&&!g&&d.entitiesToEdit.push({contentTypeName:f,editControlTitle:"Entity"}),d.registeredControls=[],d.registerEditControl=function(a){d.registeredControls.push(a)},d.isValid=function(){var a=!0;return angular.forEach(d.registeredControls,function(b,c){b.isValid()||(a=!1)}),a},d.save=function(){var b=[];angular.forEach(d.registeredControls,function(a,c){b.push(a.save())}),a.all(b).then(function(){alert("All save promises resolved!")})}}])}(),function(){"use strict";var a=angular.module("sxcFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","ui.tree","2sxc4ng","SxcEditTemplates"],["formlyConfigProvider",function(a){a.setType({name:"string-wysiwyg",templateUrl:"fieldtemplates/templates/string-wysiwyg.html",wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-WysiwygCtrl as vm"}),a.setType({name:"hyperlink-default",templateUrl:"fieldtemplates/templates/hyperlink-default.html",wrapper:["bootstrapLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-HyperlinkCtrl as vm"}),a.setType({name:"entity-default",templateUrl:"fieldtemplates/templates/entity-default.html",wrapper:["bootstrapLabel","bootstrapHasError"],controller:"FieldTemplate-EntityCtrl"})}]);a.controller("FieldTemplate-HyperlinkCtrl",["$modal","$scope","$http","sxc",function(a,b,c,d){var e=this;e.modalInstance=null,e.testLink="",e.bridge={valueChanged:function(a,d){b.$apply(function(){a&&(b.value.Value=a,"file"==d&&c.get("dnn/Hyperlink/GetFileByPath?relativePath="+encodeURIComponent(a)).then(function(a){a.data&&(b.value.Value="File:"+a.data.FileId)})),e.modalInstance.close()})},params:{Paths:b.to.settings.Hyperlink.Paths,FileFilter:b.to.settings.Hyperlink.FileFilter}},b.$watch("value.Value",function(a,b){a&&(-1!=a.indexOf("File")||-1!=a.indexOf("Page"))&&c.get("eav/FieldTemplateHyperlink/ResolveHyperlink?hyperlink="+encodeURIComponent(a)).then(function(a){a.data&&(e.testLink=a.data)})}),e.openDialog=function(c,d){var f="pagepicker"==c?"pagepicker":"filemanager";e.bridge.dialogType=c,e.bridge.params.CurrentValue=b.value.Value,e.modalInstance=a.open({templateUrl:"fieldtemplates/templates/hyperlink-default-"+f+".html",resolve:{bridge:function(){return e.bridge}},controller:["$scope","bridge",function(a,b){a.bridge=b}],windowClass:"sxc-dialog-filemanager"})}}]),a.controller("FieldTemplate-WysiwygCtrl",["$scope",function(a){var b=this;b.bridge={onChanged:function(b){a.$apply(function(){a.value.Value=b})},setValue:function(){console.log("Error: setValue has no override")},setReadOnly:function(){console.log("Error: setReadOnly has no override")}},a.$watch("value.Value",function(a,c){a!=c&&b.bridge.setValue(a)}),a.$watch("to.disabled",function(a,c){a!=c&&b.bridge.setReadOnly(a)})}]),a.controller("FieldTemplate-EntityCtrl",["$scope","$http","$filter","$modal",function(a,b,c,d){a.availableEntities=[],null===a.model[a.options.key]&&(a.model[a.options.key]=[]),a.addEntity=function(){"new"==a.selectedEntity?a.openNewEntityDialog():a.model[a.options.key].push(parseInt(a.selectedEntity)),a.selectedEntity=""},a.createEntityAllowed=function(){return null!==a.to.settings.Entity.EntityType&&""!==a.to.settings.Entity.EntityType},a.openNewEntityDialog=function(){var b=d.open({template:'<div style="padding:20px;"><edit-content-group edit="vm.edit"></edit-content-group></div>',controller:["entityType",function(a){var b=this;b.edit={contentTypeName:a}}],controllerAs:"vm",resolve:{entityType:function(){return a.to.settings.Entity.EntityType}}});b.result.then(function(){a.getAvailableEntities()})},a.getAvailableEntities=function(){b({method:"GET",url:"eav/EntityPicker/getavailableentities",params:{entityType:a.to.settings.Entity.EntityType}}).then(function(b){a.availableEntities=b.data})},a.getEntityText=function(b){var d=c("filter")(a.availableEntities,{Value:b});return d.length>0?d[0].Text:"(Entity not found)"},a.getAvailableEntities()}]),a.directive("webFormsBridge",["sxc",function(a){var b=a._editContentGroupConfig.tabBaseUrl+"?ctl=webformsbridge&mid="+a.id+"&popUp=true";return{restrict:"A",scope:{type:"@bridgeType",bridge:"=webFormsBridge",bridgeSyncHeight:"@bridgeSyncHeight"},link:function(a,c,d){c[0].src=b+"&type="+a.type+(a.bridge.params?"&"+$.param(a.bridge.params):""),c.on("load",function(){var b=c[0].contentWindow||c[0];if(b.connectBridge(a.bridge),"true"==a.bridgeSyncHeight){var d=function(){c.css("height",""),c.css("height",b.document.body.scrollHeight+"px")};d(),b.$(b.document).ready(function(){d()})}})}}}])}(),function(){"use strict";angular.module("sxcEditContentGroupSvc",[]).factory("sxcContentGroupService",["$http",function(a){return{get:function(b){return a.get("app/ContentGroup/Get?contentGroupGuid="+b)}}}])}(),angular.module("SxcEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("edit-contentgroup-dnnwrapper.html","<edit-content-group edit=vm.edit></edit-content-group>"),a.put("edit-entity-or-contentgroup.html",'<div><eav-language-switcher></eav-language-switcher><div ng-repeat="entityToEdit in vm.entitiesToEdit"><h2 ng-if=entityToEdit.editControlTitle>{{entityToEdit.editControlTitle}}</h2><div class=bg-info style=padding:12px ng-if="entityToEdit.isPresentation && entityToEdit.useDefaultValues">The default values are used currently. <a class="btn btn-default" ng-click="entityToEdit.useDefaultValues = false;">Create</a></div><div ng-if=!entityToEdit.useDefaultValues><div class=pull-right ng-if=entityToEdit.isPresentation><a class="btn btn-default" ng-click="entityToEdit.useDefaultValues = true;">Use default values</a></div><eav-edit-entity content-type-name={{entityToEdit.contentTypeName}} entity-id={{entityToEdit.entityId}} register-edit-control=vm.registerEditControl></eav-edit-entity></div></div><button ng-disabled=!vm.isValid() ng-click=vm.save() class="btn btn-primary submit-button">Save</button></div>'),a.put("fieldtemplates/templates/entity-default.html",'<div class=eav-entityselect><div ui-tree=options data-empty-place-holder-enabled=false><ol ui-tree-nodes ng-model=model[options.key]><li ng-repeat="item in model[options.key]" ui-tree-node class=eav-entityselect-item><div ui-tree-handle><span title="{{getEntityText(item) + \' (\' + item + \')\'}}">{{getEntityText(item)}}</span> <a data-nodrag title="Remove this item" ng-click=remove(this) class=eav-entityselect-item-remove>[remove]</a></div></li></ol></div><select class="eav-entityselect-selector form-control" ng-model=selectedEntity ng-change=addEntity() ng-show="to.settings.Entity.AllowMultiValue || model[options.key].length < 1"><option value="">-- choose --</option><option value=new ng-if=createEntityAllowed()>-- new --</option><option ng-repeat="item in availableEntities" ng-disabled="model[options.key].indexOf(item.Value) != -1" value={{item.Value}}>{{item.Text}}</option></select></div>'),a.put("fieldtemplates/templates/hyperlink-default-filemanager.html",'<div><iframe class=sxc-dialog-filemanager-iframe style="width:100%; height:100%; overflow:hidden" scrolling=no web-forms-bridge=bridge bridge-type=filemanager bridge-sync-height=false></iframe></div><style>.sxc-dialog-filemanager .modal-dialog { width: 100%;height: 100%;margin: 0; }\r\n	.sxc-dialog-filemanager .modal-content { background: none;height: 100%; }\r\n	.sxc-dialog-filemanager-iframe { position: absolute;top: 0;left: 0;right: 0;bottom: 0; }</style>'),a.put("fieldtemplates/templates/hyperlink-default-pagepicker.html",'<div><div class=modal-header><h3 class=modal-title>Select a page</h3></div><div class=modal-body style="height:370px; width:600px"><iframe style="width:100%; height:350px" web-forms-bridge=bridge bridge-type=pagepicker bridge-sync-height=false></iframe></div><div class=modal-footer></div></div>'),a.put("fieldtemplates/templates/hyperlink-default.html",'<div><div class=input-group dropdown><input type=text class=form-control ng-model=value.Value> <span class=input-group-btn><button type=button id=single-button class="btn btn-default dropdown-toggle" dropdown-toggle ng-disabled=to.disabled>...</button></span><ul class="dropdown-menu pull-right" role=menu><li role=menuitem><a ng-click="vm.openDialog(\'pagepicker\')" href=javascript:void(0)>Page Picker</a></li><li role=menuitem><a ng-click="vm.openDialog(\'imagemanager\')" href=javascript:void(0)>Image Manager</a></li><li role=menuitem><a ng-click="vm.openDialog(\'documentmanager\')" href=javascript:void(0)>Document Manager</a></li></ul></div><div class=small>Test: <a href={{vm.testLink}} target=_blank>{{vm.testLink}}</a></div></div>'),a.put("fieldtemplates/templates/string-wysiwyg.html","<iframe style=width:100% web-forms-bridge=vm.bridge bridge-type=wysiwyg bridge-sync-height=true></iframe>")}]);
//# sourceMappingURL=sxc-edit.min.js.map