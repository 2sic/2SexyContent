/*! ToSic_ToSxc 2015-11-25 */

!function(){"use strict";angular.module("sxcFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","ui.tree","2sxc4ng","SxcEditTemplates","EavConfiguration"])}(),angular.module("sxcFieldTemplates").directive("dropzone",["sxc","tabId","dragClass",function(a,b,c){return{restrict:"C",link:function(c,d,e){var f=c.$parent.to.header,g=c.$parent.options.key,h=f.Guid,i=a.resolveServiceUrl("app-content/"+f.ContentTypeName+"/"+h+"/"+g),j={url:i,maxFilesize:100,paramName:"uploadfile",maxThumbnailFilesize:10,headers:{ModuleId:a.id,TabId:b},dictDefaultMessage:"",addRemoveLinks:!1,previewsContainer:".field-"+g.toLowerCase()+" .dropzone-previews",clickable:".dropzone-adam"},k={addedfile:function(a){c.$apply(function(){c.fileAdded=!0})},success:function(a,b){b.Success?(c.$parent.value.Value="File:"+b.FileId,c.$apply()):alert("Upload failed because: "+b.Error)}},l=new Dropzone(d[0],j);angular.forEach(k,function(a,b){l.on(b,a)}),c.processDropzone=function(){l.processQueue()},c.resetDropzone=function(){l.removeAllFiles()}}}}]),function(){"use strict";angular.module("sxcFieldTemplates").directive("webFormsBridge",["sxc","portalRoot",function(a,b){var c=b+"?tabid="+$2sxc.urlParams.require("tid")+"&ctl=webformsbridge&mid="+a.id+"&popUp=true";return{restrict:"A",scope:{type:"@bridgeType",bridge:"=webFormsBridge",bridgeSyncHeight:"@bridgeSyncHeight"},link:function(a,b,d){var e="";a.bridge.params&&(e=Object.keys(a.bridge.params).map(function(b){return null!==a.bridge.params[b]&&""!==a.bridge.params[b]?[b,a.bridge.params[b]].map(encodeURIComponent).join("="):void 0}).join("&")),b[0].src=c+"&type="+a.type+(a.bridge.params?"&"+e:""),b.on("load",function(){var c=b[0].contentWindow||b[0];if(c.connectBridge(a.bridge),"true"===a.bridgeSyncHeight){var d=function(){b.css("height",""),b.css("height",c.document.body.scrollHeight+"px")};d(),c.$(c.document).ready(function(){d()})}})}}}])}(),function(){"use strict";angular.module("sxcFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"string-wysiwyg",templateUrl:"fieldtemplates/templates/string-wysiwyg.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-WysiwygCtrl as vm"}),a.setType({name:"string-wysiwyg-adv",templateUrl:"fieldtemplates/templates/string-wysiwyg.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-WysiwygCtrl as vm"})}]).controller("FieldTemplate-WysiwygCtrl",["$scope",function(a){var b=this;b.bridge={initialValue:"",initialReadOnly:!1,onChanged:function(b){a.$apply(function(){a.value.Value=b})},setValue:function(a){b.bridge.initialValue=a},setReadOnly:function(a){b.bridge.initialReadOnly=a}},a.$watch("value.Value",function(a,c){a!==c&&b.bridge.setValue(a)}),a.$watch("to.disabled",function(a,c){a!==c&&b.bridge.setReadOnly(a)})}])}(),function(){"use strict";angular.module("sxcFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"hyperlink-default",templateUrl:"fieldtemplates/templates/hyperlink-default.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-HyperlinkCtrl as vm"})}]).controller("FieldTemplate-HyperlinkCtrl",["$modal","$scope","$http","sxc",function(a,b,c,d){var e=this;e.modalInstance=null,e.testLink="",e.checkImgRegEx=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:jpg|jpeg|gif|png))(?:\?([^#]*))?(?:#(.*))?/i,e.isImage=function(){b.value;return e.checkImgRegEx.test(e.testLink)},e.thumbnailUrl=function(a){return 1===a?e.testLink+"?w=46&h=46&mode=crop":2===a?e.testLink+"?w=500&h=400&mode=max":void 0},e.bridge={valueChanged:function(a,d){b.$apply(function(){if(a&&(b.value.Value=a,"file"===d)){var f=a.replace(/\?ver=[0-9\-]*$/gi,"");c.get("dnn/Hyperlink/GetFileByPath?relativePath="+encodeURIComponent(f)).then(function(a){a.data&&(b.value.Value="File:"+a.data.FileId)})}e.modalInstance.close()})},params:{Paths:b.to.settings.merged?b.to.settings.merged.Paths:"",FileFilter:b.to.settings.merged?b.to.settings.merged.FileFilter:""}},b.$watch("value.Value",function(a,b){a&&(-1!==a.indexOf("File")||-1!==a.indexOf("Page"))&&c.get("dnn/Hyperlink/ResolveHyperlink?hyperlink="+encodeURIComponent(a)).then(function(a){a.data&&(e.testLink=a.data)})}),e.openDialog=function(c,d){var f="pagepicker"===c?"pagepicker":"filemanager";e.bridge.dialogType=c,e.bridge.params.CurrentValue=b.value.Value,e.modalInstance=a.open({templateUrl:"fieldtemplates/templates/hyperlink-default-"+f+".html",resolve:{bridge:function(){return e.bridge}},controller:["$scope","bridge",function(a,b){a.bridge=b}],windowClass:"sxc-dialog-filemanager"})}}])}(),angular.module("SxcEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("fieldtemplates/templates/hyperlink-default-filemanager.html",'<div><iframe class=sxc-dialog-filemanager-iframe style="width:100%; height:100%; overflow:hidden; border: 0" scrolling=no web-forms-bridge=bridge bridge-type=filemanager bridge-sync-height=false></iframe></div><style>.sxc-dialog-filemanager .modal-dialog { width: 100%;height: 100%;margin: 0; }\r\n	.sxc-dialog-filemanager .modal-content { background: none;height: 100%; }\r\n	.sxc-dialog-filemanager-iframe { position: absolute;top: 0;left: 0;right: 0;bottom: 0; }</style>'),a.put("fieldtemplates/templates/hyperlink-default-pagepicker.html",'<div><div class=modal-header><h3 class=modal-title translate=Edit.Fields.Hyperlink.PagePicker.Title></h3></div><div class=modal-body style="height:370px; width:600px"><iframe style="width:100%; height: 350px; border: 0" web-forms-bridge=bridge bridge-type=pagepicker bridge-sync-height=false></iframe></div><div class=modal-footer></div></div>'),a.put("fieldtemplates/templates/hyperlink-default.html",'<div><div class=dropzone><div class=input-group dropdown><div ng-if="value.Value && vm.isImage()" class="input-group-addon btn-default" style="width: 50px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; padding-left: 0px; padding-right: 0px; border-left-width: 0px; border-bottom-width: 0px; background-color: transparent; background-image: url(\'{{vm.thumbnailUrl(1)}}\')" ng-mouseover="vm.showPreview = true" ng-mouseleave="vm.showPreview = false"></div><input type=text class="form-control input-lg" ng-model=value.Value tooltip="{{\'Edit.Fields.Hyperlink.Default.Tooltip1\' | translate }}\r\n{{\'Edit.Fields.Hyperlink.Default.Tooltip2\' | translate }}\r\nADAM - sponsored with ♥ by 2sic.com"> <span class=input-group-btn style="vertical-align: top"><button type=button class="btn btn-primary dropzone-adam input-lg" ng-disabled=to.disabled tooltip="{{\'Edit.Fields.Hyperlink.Default.AdamUploadLabel\' | translate }}"><i icon=upload></i> <i icon=apple></i></button> <button tabindex=-1 type=button class="btn btn-default dropdown-toggle input-lg" dropdown-toggle ng-disabled=to.disabled><i icon=option-horizontal></i></button></span><ul class="dropdown-menu pull-right" role=menu><li role=menuitem><a class=dropzone-adam href=javascript:void(0);><i icon=apple></i> <span translate=Edit.Fields.Hyperlink.Default.MenuAdam></span></a></li><li role=menuitem><a ng-click="vm.openDialog(\'pagepicker\')" href=javascript:void(0)><i icon=home></i> <span translate=Edit.Fields.Hyperlink.Default.MenuPage></span></a></li><li role=menuitem><a ng-click="vm.openDialog(\'imagemanager\')" href=javascript:void(0)><i icon=picture></i> <span translate=Edit.Fields.Hyperlink.Default.MenuImage></span></a></li><li role=menuitem><a ng-click="vm.openDialog(\'documentmanager\')" href=javascript:void(0)><i icon=file></i> <span translate=Edit.Fields.Hyperlink.Default.MenuDocs></span></a></li></ul></div><div ng-if=vm.showPreview style="position: relative"><div style="position: absolute;z-index: 100;background: white;top: 10px;text-align: center;left: 0;right: 0"><img ng-src="{{vm.thumbnailUrl(2)}}"></div></div><div ng-if=value.Value><a href={{vm.testLink}} target=_blank tabindex=-1 tooltip={{vm.testLink}}><i icon=new-window></i> <span>&nbsp;... {{vm.testLink.substr(vm.testLink.lastIndexOf("/"), 100)}}</span></a></div><div class=dropzone-previews></div><div class=small ng-show=fileAdded><a href="http://2sxc.org/help?tag=adam" target=_blank tooltip="ADAM is the Automatic Digital Assets Manager - click to discover more"><i icon=apple></i> Adam</a> is sponsored with ♥ by <a tabindex=-1 href="http://2sic.com/" target=_blank>2sic.com</a></div></div><div ng-if=vm.debug.on>todo: enable / disable page, image picker, document manager based on settings, + translate</div></div>'),a.put("fieldtemplates/templates/string-wysiwyg.html",'<iframe style="width:100%; border: 0" web-forms-bridge=vm.bridge bridge-type=wysiwyg bridge-sync-height=true></iframe>')}]);
//# sourceMappingURL=sxc-edit.min.js.map