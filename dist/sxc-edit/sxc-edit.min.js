/*! ToSic_ToSxc 2016-01-03 */

!function(){angular.module("Adam",["SxcServices"])}(),function(){"use strict";function a(a,b,c){var d=this;d.debug=c,d.contentTypeName=a.contentTypeName,d.entityGuid=a.entityGuid,d.fieldName=a.fieldName,d.show=!1,d.subFolder=a.subFolder||"",d.folderDepth="undefined"!=typeof a.folderDepth&&null!==a.folderDepth?a.folderDepth:2,d.showFolders=!!d.folderDepth,d.allowAssetsInRoot=a.allowAssetsInRoot||!0,d.folderMetadataContentType=a.folderMetadataContentType||"",d.metadataContentType=a.metadataContentType||"",d.defaultMetadataContentType=d.metadataContentType.split("\n")[0],d.disabled=a.ngDisabled,d.enableSelect=a.enableSelect||!0,d.activate=function(){a.autoLoad&&d.toggle(),a.registerSelf&&a.registerSelf(d)},d.svc=b(d.contentTypeName,d.entityGuid,d.fieldName,d.subFolder),d.refresh=d.svc.liveListReload,d.get=function(){d.items=d.svc.liveList(),d.folders=d.svc.folders},d.toggle=function(){d.show=!d.show,d.show&&d.get()},d.openUpload=function(){d.dropzone.openUpload()},d.select=function(b){!d.disabled&&d.enableSelect&&a.updateCallback("File:"+b.Id)},d.addFolder=function(){if(!d.disabled){var a=window.prompt("Folder Name?");a&&d.svc.addFolder(a).then(d.refresh)}},d.del=function(a){if(!d.disabled){var b=window.confirm("delete ok?");b&&d.svc["delete"](a)}},d.goIntoFolder=function(a){var b=d.svc.goIntoFolder(a);d.subFolder=b},d.goUp=function(){d.subFolder=d.svc.goUp()},d.currentFolderDepth=function(){return d.svc.folders.length},d.allowCreateFolder=function(){return d.svc.folders.length<d.folderDepth},d.activate()}var b=angular.module("Adam");b.controller("BrowserController",a),a.$inject=["$scope","adamSvc","debugState"]}(),function(){angular.module("Adam").directive("adamBrowser",function(){return{restrict:"E",templateUrl:"adam/browser.html",transclude:!1,require:"^dropzone",link:function(a,b,c,d){d.adam=a.vm,a.vm.dropzone=d},scope:{contentTypeName:"=",entityGuid:"=",fieldName:"=",subFolder:"=",folderDepth:"=",metadataContentType:"=",folderMetadataContentType:"=",allowAssetsInRoot:"=",autoLoad:"=",updateCallback:"=",registerSelf:"=",enableSelect:"=",ngDisabled:"="},controller:"BrowserController",controllerAs:"vm"}})}(),function(){angular.module("Adam").directive("dropzoneUploadPreview",function(){return{restrict:"E",templateUrl:"adam/dropzone-upload-preview.html",replace:!0,transclude:!1}})}(),angular.module("Adam").directive("dropzone",["sxc","tabId","dragClass",function(a,b,c){return{restrict:"C",link:function(c,d,e,f){var g=c.$parent.to.header,h=c.$parent.options.key,i=g.Guid,j=a.resolveServiceUrl("app-content/"+g.ContentTypeName+"/"+i+"/"+h),k={url:j,urlRoot:j,maxFilesize:100,paramName:"uploadfile",maxThumbnailFilesize:10,headers:{ModuleId:a.id,TabId:b},dictDefaultMessage:"",addRemoveLinks:!1,previewsContainer:".field-"+h.toLowerCase()+" .dropzone-previews"},l={addedfile:function(a){c.$apply(function(){c.uploading=!0})},processing:function(a){this.options.url=""===f.adam.subFolder?this.options.urlRoot:this.options.urlRoot+"?subfolder="+f.adam.subFolder},success:function(a,b){b.Success?(c.$parent.value.Value="File:"+b.FileId,c.$apply()):alert("Upload failed because: "+b.Error)},queuecomplete:function(a){0===this.getUploadingFiles().length&&0===this.getQueuedFiles().length&&(c.uploading=!1,f.adam.refresh())}},m=new Dropzone(d[0],k);angular.forEach(l,function(a,b){m.on(b,a)}),c.processDropzone=function(){m.processQueue()},c.resetDropzone=function(){m.removeAllFiles()},f.openUpload=function(){m.hiddenFileInput.click()}},controller:function(){var a=this;a.adam={show:!1,subFolder:"",refresh:function(){}}}}}]),function(){"use strict";angular.module("sxcFieldTemplates",["formly","formlyBootstrap","ui.bootstrap","ui.tree","2sxc4ng","SxcEditTemplates","EavConfiguration","SxcServices","Adam"])}(),function(){"use strict";angular.module("sxcFieldTemplates").directive("webFormsBridge",["sxc","portalRoot",function(a,b){var c=b+"Default.aspx?tabid="+$2sxc.urlParams.require("tid")+"&ctl=webformsbridge&mid="+a.id+"&popUp=true";return{restrict:"A",scope:{type:"@bridgeType",bridge:"=webFormsBridge",bridgeSyncHeight:"@bridgeSyncHeight"},link:function(a,b,d){var e="";a.bridge.params&&(e=Object.keys(a.bridge.params).map(function(b){return null!==a.bridge.params[b]&&""!==a.bridge.params[b]?[b,a.bridge.params[b]].map(encodeURIComponent).join("="):void 0}).join("&")),b[0].src=c+"&type="+a.type+(a.bridge.params?"&"+e:""),b.on("load",function(){var c=b[0].contentWindow||b[0];if(c.connectBridge(a.bridge),"true"===a.bridgeSyncHeight){var d=function(){b.css("height",""),b.css("height",c.document.body.scrollHeight+"px")};d(),c.$(c.document).ready(function(){d()})}})}}}])}(),function(){"use strict";angular.module("sxcFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"hyperlink-default",templateUrl:"fieldtemplates/templates/hyperlink-default.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-HyperlinkCtrl as vm"})}]).controller("FieldTemplate-HyperlinkCtrl",["$modal","$scope","$http","sxc","adamSvc","debugState",function(a,b,c,d,e,f){var g=this;g.debug=f,g.modalInstance=null,g.testLink="",g.checkImgRegEx=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:jpg|jpeg|gif|png))(?:\?([^#]*))?(?:#(.*))?/i,g.isImage=function(){b.value;return g.checkImgRegEx.test(g.testLink)},g.thumbnailUrl=function(a){return 1===a?g.testLink+"?w=46&h=46&mode=crop":2===a?g.testLink+"?w=500&h=400&mode=max":void 0},g.bridge={valueChanged:function(a,d){b.$apply(function(){if(a&&(b.value.Value=a,"file"===d)){var e=a.replace(/\?ver=[0-9\-]*$/gi,"");c.get("dnn/Hyperlink/GetFileByPath?relativePath="+encodeURIComponent(e)).then(function(a){a.data&&(b.value.Value="File:"+a.data.FileId)})}g.modalInstance.close()})},params:{Paths:b.to.settings.merged?b.to.settings.merged.Paths:"",FileFilter:b.to.settings.merged?b.to.settings.merged.FileFilter:""}},b.$watch("value.Value",function(a,b){if(a){var d=a.toLowerCase();-1!==d.indexOf("file")||-1!==d.indexOf("page")?c.get("dnn/Hyperlink/ResolveHyperlink?hyperlink="+encodeURIComponent(a)).then(function(a){a.data&&(g.testLink=a.data)}):g.testLink=a}}),g.openDialog=function(c,d){var e="pagepicker"===c?"pagepicker":"filemanager";g.bridge.dialogType=c,g.bridge.params.CurrentValue=b.value.Value,g.modalInstance=a.open({templateUrl:"fieldtemplates/templates/hyperlink-default-"+e+".html",resolve:{bridge:function(){return g.bridge}},controller:["$scope","bridge",function(a,b){a.bridge=b}],windowClass:"sxc-dialog-filemanager"})},g.registerAdam=function(a){g.adam=a},g.setValue=function(a){b.value.Value=a},g.toggleAdam=function(){g.adam.toggle()}}])}(),function(){"use strict";angular.module("sxcFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"hyperlink-library",templateUrl:"fieldtemplates/templates/hyperlink-library.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-Library as vm"})}]).controller("FieldTemplate-Library",["$modal","$scope","$http","sxc","adamSvc","debugState",function(a,b,c,d,e,f){var g=this;g.debug=f,g.modalInstance=null,g.testLink="",g.registerAdam=function(a){g.adam=a},g.setValue=function(a){b.value.Value=a},g.toggleAdam=function(){g.adam.toggle()}}])}(),function(){"use strict";angular.module("sxcFieldTemplates").config(["formlyConfigProvider",function(a){a.setType({name:"string-wysiwyg",templateUrl:"fieldtemplates/templates/string-wysiwyg.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-WysiwygCtrl as vm"}),a.setType({name:"string-wysiwyg-adv",templateUrl:"fieldtemplates/templates/string-wysiwyg.html",wrapper:["eavLabel","bootstrapHasError","eavLocalization"],controller:"FieldTemplate-WysiwygCtrl as vm"})}]).controller("FieldTemplate-WysiwygCtrl",["$scope",function(a){var b=this;b.bridge={initialValue:"",initialReadOnly:!1,onChanged:function(b){a.$apply(function(){a.value.Value=b})},setValue:function(a){b.bridge.initialValue=a},setReadOnly:function(a){b.bridge.initialReadOnly=a}},a.$watch("value.Value",function(a,c){a!==c&&b.bridge.setValue(a)}),a.$watch("to.disabled",function(a,c){a!==c&&b.bridge.setReadOnly(a)})}])}(),angular.module("SxcEditTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("adam/browser.html",'<div ng-if=vm.show><div class="dz-preview dropzone-adam" ng-disabled=vm.disabled tooltip="{{\'Edit.Fields.Hyperlink.Default.AdamUploadLabel\' | translate }}" ng-click=vm.openUpload()><div class=dz-image style="background-color: whitesmoke"></div><div class=dz-details style="opacity: 1"><div class=dz-size><button type=button class="btn btn-primary btn-lg" ng-disabled=vm.disabled><i icon=plus></i> <i icon=file></i></button></div><div class=dz-filename><span data-dz-name="">drag & drop files</span></div></div></div><div ng-show="vm.allowCreateFolder() || vm.debug.on" class=dz-preview ng-disabled=vm.disabled ng-click=vm.addFolder()><div class=dz-image style="background-color: whitesmoke"></div><div class=dz-details style="opacity: 1"><div class=dz-size><button type=button class="btn btn-default btn-lg" ng-disabled=vm.disabled><i icon=plus></i> <i icon=th-large></i></button></div><div class=dz-filename><span data-dz-name="">new folder</span></div></div></div><div ng-show="vm.showFolders || vm.debug.on" class=dz-preview ng-disabled=vm.disabled ng-if="vm.folders.length > 0" ng-click=vm.goUp()><div class=dz-image style="background-color: whitesmoke"></div><div class=dz-details style="opacity: 1"><div class=dz-size><button type=button class="btn btn-default btn-square btn-lg" ng-disabled=vm.disabled><i icon=level-up></i></button></div><div class=dz-filename><span data-dz-name="">up to level {{vm.currentFolderDepth() - 1}}</span></div></div></div><div ng-show="vm.showFolders || vm.debug.on" class=dz-preview ng-repeat="item in vm.items | filter: { IsFolder: true }  | orderBy:\'Name\'" ng-click=vm.goIntoFolder(item)><div ng-if="item.Type == \'folder\'" class=dz-image style="background-color: whitesmoke"></div><div class="dz-details file-type-{{item.Type}}"><div class=dz-size ng-if="item.Type == \'folder\'"><span data-dz-size="" style="font-size: xx-large"><i icon=th-large></i></span></div><div class=dz-filename><span data-dz-name="">{{ item.Name }}</span></div><div class=dz-filename><span ng-click=vm.del(item) stop-event=click ng-disabled=vm.disabled><i icon=remove></i></span></div></div></div><div class=dz-preview ng-class="{ \'dz-success\': value.Value.toLowerCase() == \'file:\' + item.Id }" ng-repeat="item in vm.items | filter: { IsFolder: false }  | orderBy:\'Name\'" ng-click=vm.select(item) ng-disabled="vm.disabled || !vm.enableSelect"><div ng-if="item.Type == \'image\'" class=dz-image><img data-dz-thumbnail="" alt="{{ item.Id + \':\' + item.Name }}" ng-src="{{ \'/portals/0/\' + item.Path + \'?w=120&h=120&mode=crop\' }}"></div><div class="dz-details file-type-{{item.Type}}"><div class="dz-size file-icon" ng-if="item.Type == \'image\'"><span data-dz-size=""><strong>{{ item.Id }}</strong></span></div><div class="dz-size file-actions" ng-if="item.Type == \'document\' || item.Type == \'file\'"><span data-dz-size=""><button type=button class="btn btn-subtle btn-lg" ng-disabled=vm.disabled><i icon=file></i></button></span></div><div class=dz-filename><span data-dz-name="">{{ item.Name }}</span></div><div class=dz-filename><span ng-click=vm.del(item) stop-event=click><i icon=remove></i></span> <span data-dz-name="">{{ (item.Size / 1024).toFixed(0) }} kb</span></div></div><div class=dz-success-mark><svg width=54px height=54px viewbox="0 0 54 54" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink xmlns:sketch=http://www.bohemiancoding.com/sketch/ns><title>Check</title><defs></defs><g id=Page-1 stroke=none stroke-width=1 fill=none fill-rule=evenodd sketch:type=MSPage><path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id=Oval-2 stroke-opacity=0.198794158 stroke=#747474 fill-opacity=0.816519475 fill=#FFFFFF sketch:type=MSShapeGroup></path></g></svg></div></div></div>'),a.put("adam/dropzone-upload-preview.html","<div ng-show=uploading><div class=dropzone-previews></div></div>"),a.put("fieldtemplates/templates/hyperlink-default-filemanager.html",'<div><iframe class=sxc-dialog-filemanager-iframe style="width:100%; height:100%; overflow:hidden; border: 0" scrolling=no web-forms-bridge=bridge bridge-type=filemanager bridge-sync-height=false></iframe></div><style>.sxc-dialog-filemanager .modal-dialog { width: 100%;height: 100%;margin: 0; }\r\n	.sxc-dialog-filemanager .modal-content { background: none;height: 100%; }\r\n	.sxc-dialog-filemanager-iframe { position: absolute;top: 0;left: 0;right: 0;bottom: 0; }</style>'),a.put("fieldtemplates/templates/hyperlink-default-pagepicker.html",'<div><div class=modal-header><h3 class=modal-title translate=Edit.Fields.Hyperlink.PagePicker.Title></h3></div><div class=modal-body style="height:370px; width:600px"><iframe style="width:100%; height: 350px; border: 0" web-forms-bridge=bridge bridge-type=pagepicker bridge-sync-height=false></iframe></div><div class=modal-footer></div></div>'),a.put("fieldtemplates/templates/hyperlink-default.html",'<div><div class=dropzone><div class=input-group dropdown><div ng-if="value.Value && vm.isImage()" class="input-group-addon btn-default" style="width: 46px; padding-top: 0px; padding-bottom: 0px; border-top-width: 0px; padding-left: 0px; padding-right: 0px; border-left-width: 0px; border-bottom-width: 0px; background-color: transparent; background-image: url(\'{{vm.thumbnailUrl(1)}}\')" ng-mouseover="vm.showPreview = true" ng-mouseleave="vm.showPreview = false"></div><input type=text class="form-control input-lg" ng-model=value.Value tooltip="{{\'Edit.Fields.Hyperlink.Default.Tooltip1\' | translate }}\r\n{{\'Edit.Fields.Hyperlink.Default.Tooltip2\' | translate }}\r\nADAM - sponsored with ♥ by 2sic.com"> <span class=input-group-btn style="vertical-align: top"><button type=button class="btn btn-primary btn-lg" ng-disabled=to.disabled tooltip="{{\'Edit.Fields.Hyperlink.Default.AdamUploadLabel\' | translate }}" ng-click=vm.toggleAdam()><i icon=upload></i> <i icon=apple></i></button> <button tabindex=-1 type=button class="btn btn-default dropdown-toggle btn-lg btn-square" dropdown-toggle ng-disabled=to.disabled><i icon=option-horizontal></i></button></span><ul class="dropdown-menu pull-right" role=menu><li role=menuitem><a class=dropzone-adam href=javascript:void(0);><i icon=apple></i> <span translate=Edit.Fields.Hyperlink.Default.MenuAdam></span></a></li><li role=menuitem ng-if="to.settings[\'merged\'].ShowPagePicker"><a ng-click="vm.openDialog(\'pagepicker\')" href=javascript:void(0)><i icon=home></i> <span translate=Edit.Fields.Hyperlink.Default.MenuPage></span></a></li><li role=menuitem ng-if="to.settings[\'merged\'].ShowImageManager"><a ng-click="vm.openDialog(\'imagemanager\')" href=javascript:void(0)><i icon=picture></i> <span translate=Edit.Fields.Hyperlink.Default.MenuImage></span></a></li><li role=menuitem ng-if="to.settings[\'merged\'].ShowFileManager"><a ng-click="vm.openDialog(\'documentmanager\')" href=javascript:void(0)><i icon=file></i> <span translate=Edit.Fields.Hyperlink.Default.MenuDocs></span></a></li></ul></div><div ng-if=vm.showPreview style="position: relative"><div style="position: absolute; z-index: 100; background: white; top: 10px; text-align: center; left: 0; right: 0"><img ng-src="{{vm.thumbnailUrl(2)}}"></div></div><div class="small pull-right"><a href="http://2sxc.org/help?tag=adam" target=_blank tooltip="ADAM is the Automatic Digital Assets Manager - click to discover more"><i icon=apple></i> Adam</a> is sponsored with ♥ by <a tabindex=-1 href="http://2sic.com/" target=_blank>2sic.com</a></div><div ng-if=value.Value><a href={{vm.testLink}} target=_blank tabindex=-1 tooltip={{vm.testLink}}><i icon=new-window></i> <span>&nbsp;... {{vm.testLink.substr(vm.testLink.lastIndexOf("/"), 100)}}</span></a></div><adam-browser content-type-name=to.header.ContentTypeName entity-guid=to.header.Guid field-name=options.key auto-load=false folder-depth=0 sub-folder="" update-callback=vm.setValue register-self=vm.registerAdam ng-disabled=to.disabled></adam-browser><dropzone-upload-preview></dropzone-upload-preview></div></div>'),a.put("fieldtemplates/templates/hyperlink-library.html",'<div><div class=dropzone><adam-browser content-type-name=to.header.ContentTypeName entity-guid=to.header.Guid field-name=options.key auto-load=true sub-folder="" folder-depth=to.settings.merged.FolderDepth metadata-content-type=to.settings.merged.MetadataContentType folder-metadata-content-type=to.settings.merged.FolderMetadataContentType allow-assets-in-root=to.settings.merged.allowAssetsInRoot enable-select=false update-callback=vm.setValue register-self=vm.registerAdam></adam-browser><dropzone-upload-preview></dropzone-upload-preview><div class="small pull-right"><a href="http://2sxc.org/help?tag=adam" target=_blank tooltip="ADAM is the Automatic Digital Assets Manager - click to discover more"><i icon=apple></i> Adam</a> is sponsored with ♥ by <a tabindex=-1 href="http://2sic.com/" target=_blank>2sic.com</a></div></div></div>'),a.put("fieldtemplates/templates/string-wysiwyg.html",'<iframe style="width:100%; border: 0" web-forms-bridge=vm.bridge bridge-type=wysiwyg bridge-sync-height=true></iframe>')}]);
//# sourceMappingURL=sxc-edit.min.js.map