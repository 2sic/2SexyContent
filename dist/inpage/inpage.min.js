/*! ToSic_ToSxc 2016-01-07 */

var $2sxcActionMenuMapper=function(a){return{changeLayoutOrContent:function(){$2sxc(a).manage._getSelectorScope().show(!0)},addItem:function(){$2sxc(a).manage.action({action:"add",useModuleList:!0})},edit:function(){$2sxc(a).manage.action({action:"edit",useModuleList:!0,sortOrder:0})},adminApp:function(){$2sxc(a).manage._openNgDialog({action:"app"})},adminZone:function(){$2sxc(a).manage._openNgDialog({action:"zone"})}}};angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("template-selector/template-selector.html",'<div ng-cloak ng-show=vm.manageInfo.templateChooserVisible class="dnnFormMessage dnnFormInfo"><div class=sc-selectors><select ng-show=!vm.manageInfo.isContentApp ng-model=vm.appId class=sc-selector-app ng-options="a.AppId as a.Name for a in vm.apps" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option value="" ng-disabled="vm.appId != null" translate=TemplatePicker.AppPickerDefault></option></select><select ng-show=vm.manageInfo.isContentApp ng-model=vm.contentTypeId class=sc-selector-contenttype ng-options="c.StaticName as c.Name for c in vm.contentTypes" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><select ng-show="vm.manageInfo.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null &&  vm.filteredTemplates().length > 1)" ng-model=vm.templateId class=sc-selector-template ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select></div><div class=sc-selector-actions><a ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" class=sc-selector-save ng-click="vm.persistTemplate(false, false);" title="{{ \'TemplatePicker.Save\' | translate }}">{{ \'TemplatePicker.Save\' | translate }}</a> <a ng-show="vm.undoTemplateId != null" class=sc-selector-close ng-click=vm.cancelTemplateChange(); title="{{ \'TemplatePicker.\' + (vm.manageInfo.isContentApp ? \'Cancel\' : \'Close\') | translate }}">{{ \'TemplatePicker.\' + (vm.manageInfo.isContentApp ? \'Cancel\' : \'Close\') | translate }}</a></div><div class="sc-loading sc-loading-nobg" ng-show=vm.loading></div></div>')}]),$2sxc.getManageController=function(a){var b=$(".DnnModule-"+a),c=$.parseJSON(b.find("div[data-2sxc]").attr("data-2sxc")).manage,d=$.parseJSON(b.find("div[data-2sxc-globals]").attr("data-2sxc-globals"));c.ngDialogUrl=c.applicationRoot+"desktopmodules/tosic_sexycontent/dist/dnn/ui.html",c.ngDialogParams={zoneId:c.zoneId,appId:c.appId,tid:c.config.tabId,mid:c.config.moduleId,lang:c.lang,langpri:c.langPrimary,langs:JSON.stringify(c.languages),portalroot:d.PortalRoot,websiteroot:c.applicationRoot,user:c.user,approot:c.config&&c.config.appPath?c.config.appPath:null};var e=c.config,f=c.user.canDesign,g=(c.user.canDevelop,c.isContentApp),h={"default":{hideFirst:!0,action:function(a,b){alert("not implemented yet")}},edit:{title:"Toolbar.Edit",iclass:"icon-sxc-pencil",lightbox:!0,hideFirst:!0,showOn:"default",action:function(a,b){i._openNgDialog(a,b)}},"new":{title:"Toolbar.New",iclass:"icon-sxc-plus",lightbox:!0,hideFirst:!0,showOn:"default",action:function(a,b){i._openNgDialog($.extend({},a,{sortOrder:a.sortOrder+1}),b)}},layout:{title:"Toolbar.ChangeLayout",iclass:"icon-sxc-glasses",lightbox:!1,hideFirst:!0,showOn:"default",uiActionOnly:!0,action:function(a,b){i._getSelectorScope().toggle()}},add:{title:"Toolbar.AddDemo",iclass:"icon-sxc-plus-circled",lightbox:!1,hideFirst:!0,showOn:"edit",action:function(a,b){i._getSelectorScope().addItem(a.sortOrder+1)}},replace:{title:"Toolbar.Replace",iclass:"icon-sxc-replace",lightbox:!0,hideFirst:!0,showOn:"edit",action:function(a,b){i._openNgDialog(a,b)}},publish:{title:"Toolbar.Published",iclass:"icon-sxc-eye",iclass2:"icon-sxc-eye-off",lightbox:!1,hideFirst:!0,disabled:!0,showOn:"edit",action:function(a,b){if(a.isPublished)return void alert(i.translate("Toolbar.AlreadyPublished"));var c=-1===a.sortOrder?"listcontent":"content",d=-1===a.sortOrder?0:a.sortOrder;i._getSelectorScope().publish(c,d)}},moveup:{title:"Toolbar.MoveUp",iclass:"icon-sxc-move-up",lightbox:!1,hideFirst:!0,disabled:!1,showOn:"edit",action:function(a,b){i._getSelectorScope().changeOrder(a.sortOrder,Math.max(a.sortOrder-1,0))}},movedown:{title:"Toolbar.MoveDown",iclass:"icon-sxc-move-down",lightbox:!1,hideFirst:!0,disabled:!1,showOn:"edit",action:function(a,b){i._getSelectorScope().changeOrder(a.sortOrder,a.sortOrder+1)}},sort:{title:"Toolbar.Sort",iclass:"icon-sxc-list-numbered",lightbox:!0,hideFirst:!0,showOn:"design",action:function(a,b){i._openNgDialog(a,b)}},remove:{title:"Toolbar.Remove",iclass:"icon-sxc-minus-circled",lightbox:!1,hideFirst:!0,disabled:!0,showOn:"edit",action:function(a,b){confirm(i.translate("Toolbar.ConfirmRemove"))&&i._getSelectorScope().removeFromList(a.sortOrder)}},develop:{title:"Toolbar.EditView",iclass:"icon-sxc-code",lightbox:!0,hideFirst:!0,showOn:"admin",uiActionOnly:!0,action:function(a,b){i._openNgDialog(a,b)}},app:{title:"Toolbar.App",iclass:"icon-sxc-settings",lightbox:!0,hideFirst:!0,showOn:"admin",uiActionOnly:!0,action:function(a,b){i._openNgDialog(a,b)}},"manage-apps":{title:"Toolbar.ManageApps",iclass:"icon-sxc-manage",lightbox:!0,hideFirst:!0,showOn:"admin",uiActionOnly:!0,action:function(a,b){i._openNgDialog(a,b)}},more:{title:"Toolbar.MoreActions",iclass:"icon-sxc-options btn-mode",borlightboxder:!1,hideFirst:!1,showOn:"default,edit,design,admin",uiActionOnly:!0,action:function(a,b){var c=$(b.target).closest("ul.sc-menu"),d=Number(c.attr("data-state")||0),e=(d+1)%(f?4:3);c.removeClass("show-set-"+d).addClass("show-set-"+e).attr("data-state",e)}}},i={isEditMode:function(){return c.isEditMode},_toolbarConfig:e,_manageInfo:c,getNgLink:function(a){a=$.extend({},e,a);var b={dialog:"edit",mode:"new"===a.action?"new":"edit"},d=[];if(a.useModuleList||("new"!==a.action?d.push({EntityId:a.entityId}):(a.contentType||a.attributeSetName)&&d.push({ContentTypeName:a.contentType||a.attributeSetName})),a.useModuleList||"replace"===a.action||"sort"===a.action){var f=-1!==a.sortOrder,g=f?a.sortOrder:0;d.push({Group:{Guid:a.contentGroupId,Index:g,Part:f?"content":"listcontent",Add:"new"===a.action},Title:i.translate("EditFormTitle."+(f?"Content":"ListContent"))}),"replace"!==a.action&&d.push({Group:{Guid:a.contentGroupId,Index:g,Part:f?"presentation":"listpresentation",Add:"new"===a.action},Title:i.translate("EditFormTitle."+(f?"Presentation":"ListPresentation"))})}if(-1!==["replace","app","zone","sort","develop"].indexOf(a.action)&&(b.dialog=a.action),"develop"===a.action&&(d=[{EntityId:c.templateId}]),a.prefill)for(var h=0;h<d.length;h++)d[h].Prefill=a.prefill;return d.length&&(b.items=JSON.stringify(d)),c.ngDialogUrl+"#"+$.param(c.ngDialogParams)+"&"+$.param(b)},_openNgDialog:function(a,b,c){var d=function(){i._getSelectorScope().reload(),c()},e=i.getNgLink(a);b&&b.shiftKey?window.open(e):$2sxc.totalPopup.open(e,d)},action:function(a,b){var c=b||window.event,d=h[a.action]||h["default"];return d.uiActionOnly?d.action(a,c):void i._getSelectorScope().prepareToAddContent().then(function(){d.action(a,c)})},getButton:function(b){b.entity&&b.entity._2sxcEditInformation&&(b.entity._2sxcEditInformation.entityId&&(b.entityId=b.entity._2sxcEditInformation.entityId,b.useModuleList=!1),b.entity._2sxcEditInformation.sortOrder&&(b.sortOrder=b.entity._2sxcEditInformation.sortOrder,b.useModuleList=!0),delete b.entity);for(var c=h[b.action]||h["default"],d="",e=c.showOn.split(","),f=0;f<e.length;f++)d+=" show-"+e[f];var g=$("<a />",{"class":"sc-"+b.action+"  "+(c.lightbox?"box":"")+d,onclick:"javascript:$2sxc("+a+").manage.action("+JSON.stringify(b)+", event);",title:i.translate(c.title)}),j=$("<div/>"),k=$('<i class="'+c.iclass+'" aria-hidden="true"></i>');return"publish"===b.action&&b.isPublished===!1&&(g.addClass("show-default").removeClass("show-edit").attr("title",i.translate("Toolbar.Unpublished")),k.removeClass(c.iclass).addClass(c.iclass2)),g.html(j.html(k)),g[0].outerHTML},getToolbar:function(a){var b=[];a.action?b=[a]:$.isArray(a)?b=a:(b.push($.extend({},a,{action:"edit"})),e.isList&&-1!==a.sortOrder&&(b.push($.extend({},a,{action:"new"})),a.useModuleList&&b.push($.extend({},a,{action:"add"})),b.push($.extend({},a,{action:"remove"})),a.useModuleList&&(0!==a.sortOrder&&b.push($.extend({},a,{action:"moveup"})),b.push($.extend({},a,{action:"movedown"}))),b.push($.extend({},a,{action:"sort"}))),b.push($.extend({},a,{action:"publish"})),a.useModuleList&&b.push($.extend({},a,{action:"replace"})),b.push($.extend({},a,{action:"layout"})),f&&(b.push($.extend({},a,{action:"app"})),b.push($.extend({},a,{action:"develop"})),g||b.push($.extend({},a,{action:"manage-apps"}))),b.push($.extend({},a,{action:"more"})));for(var c="sc-menu show-set-0"+(-1===a.sortOrder?" listContent":""),d=$("<ul />",{"class":c,onclick:"javascript: var e = arguments[0] || window.event; e.stopPropagation();"}),h=0;h<b.length;h++)d.append($("<li />").append($(i.getButton(b[h]))));return d[0].outerHTML},_processToolbars:function(){$(".sc-menu[data-toolbar]",$(".DnnModule-"+a)).each(function(){var b=$.parseJSON($(this).attr("data-toolbar"));$(this).replaceWith($2sxc(a).manage.getToolbar(b))})},_getSelectorScope:function(){var b=document.querySelector(".DnnModule-"+a+" .sc-selector-wrapper");return angular.element(b).scope().vm},translate:function(a){return i._getSelectorScope().translate(a)}};return i},$(document).ready(function(){$(".sc-menu").click(function(a){a.stopPropagation()});var a=$("div[data-2sxc]");window.setTimeout(function(){a.each(function(){var a=$(this).data("2sxc").moduleId;$2sxc(a).manage._processToolbars()})},0),window.EavEditDialogs=[]}),function(){var a=angular.module("2sxc.view",["2sxc4ng","pascalprecht.translate","SxcInpageTemplates","EavConfiguration"]);a.config(["$translateProvider","AppInstanceId","$translatePartialLoaderProvider","languages",function(a,b,c,d){$2sxc(b).manage._manageInfo;a.preferredLanguage(d.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(d.fallbackLanguage).useLoader("$translatePartialLoader",{urlTemplate:d.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("inpage")}])}(),function(){var a=angular.module("2sxc.view");a.factory("moduleApiService",["$http",function(a){return{saveTemplate:function(b,c,d){return a.get("View/Module/SaveTemplateId",{params:{templateId:b,forceCreateContentGroup:c,newTemplateChooserState:d}})},addItem:function(b){return a.get("View/Module/AddItem",{params:{sortOrder:b}})},getSelectableApps:function(){return a.get("View/Module/GetSelectableApps")},setAppId:function(b){return a.get("View/Module/SetAppId",{params:{appId:b}})},getSelectableContentTypes:function(){return a.get("View/Module/GetSelectableContentTypes")},getSelectableTemplates:function(){return a.get("View/Module/GetSelectableTemplates")},setTemplateChooserState:function(b){return a.get("View/Module/SetTemplateChooserState",{params:{state:b}})},renderTemplate:function(b){return a.get("View/Module/RenderTemplate",{params:{templateId:b}})},changeOrder:function(b,c){return a.get("View/Module/ChangeOrder",{params:{sortOrder:b,destinationSortOrder:c}})},publish:function(b,c){return a.get("view/module/publish",{params:{part:b,sortOrder:c}})},removeFromList:function(b){return a.get("View/Module/RemoveFromList",{params:{sortOrder:b}})}}}])}(),function(){var a=angular.module("2sxc.view");a.controller("TemplateSelectorCtrl",["$scope","$attrs","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate",function(a,b,c,d,e,f,g,h,i){var j="_LayoutElement",k=a,l=c,m=b.importappdialog,n=".DnnModule-"+d+" .sc-viewport",o=this;o.apps=[],o.contentTypes=[],o.templates=[],o.manageInfo=e.manage._manageInfo,o.templateId=o.manageInfo.templateId,o.undoTemplateId=o.templateId,o.contentTypeId=""===o.manageInfo.contentTypeId&&null!==o.manageInfo.templateId?j:o.manageInfo.contentTypeId,o.undoContentTypeId=o.contentTypeId,o.appId=o.manageInfo.appId,o.savedAppId=o.manageInfo.appId,o.loading=0,o.filteredTemplates=function(a){if(!o.manageInfo.isContentApp)return o.templates;var b={ContentTypeStaticName:a===j?"":a};return f("filter")(o.templates,b,!0)},o.reloadTemplates=function(){o.loading++;var a=l.getSelectableContentTypes(),b=l.getSelectableTemplates();g.all([a,b]).then(function(a){o.contentTypes=a[0].data,o.templates=a[1].data,f("filter")(o.templates,{ContentTypeStaticName:""},!0).length>0&&(o.contentTypes.push({StaticName:j,Name:i.instant("TemplatePicker.LayoutElement")}),o.contentTypes=f("orderBy")(o.contentTypes,"Name")),o.loading--})},k.$watch("vm.templateId",function(a,b){if(a!==b){if(o.manageInfo.isContentApp)return o.renderTemplate(a);o.loading++,o.persistTemplate(!1).then(function(){h.location.reload()})}}),k.$watch("vm.contentTypeId",function(a,b){if(a!=b){var c=o.filteredTemplates(a)[0].TemplateId;o.templateId!==c&&null!==c&&(o.templateId=c)}}),k.$watch("vm.appId",function(a,b){return a!==b&&null!==a?-1===a?void(window.location=m):void l.setAppId(a).then(function(){h.location.reload()}):void 0}),o.cancelTemplateChange=function(){o.templateId=o.undoTemplateId,o.contentTypeId=o.undoContentTypeId,o.manageInfo.templateChooserVisible=!1,l.setTemplateChooserState(!1),o.manageInfo.isContentApp&&o.reloadTemplates()},o.persistTemplate=function(a,b){var c,d=!!o.manageInfo.hasContent&&o.undoTemplateId===o.templateId;c=d?o.manageInfo.templateChooserVisible?l.setTemplateChooserState(!1):g.when(null):l.saveTemplate(o.templateId,a,b).then(function(a){if(200!==a.status)return void alert("error - result not ok, was not able to create ContentGroup");var b=a.data;null!==b&&(b=b.replace(/[\",\']/g,""),console&&console.log("created content group {"+b+"}"),e.manage._manageInfo.config.contentGroupId=b)});var f=c.then(function(){o.undoTemplateId=o.templateId,o.undoContentTypeId=o.contentTypeId,o.manageInfo.templateChooserVisible=!1,o.manageInfo.hasContent||(o.manageInfo.hasContent=a)});return f},o.renderTemplate=function(a){o.loading++,l.renderTemplate(a).then(function(a){try{$(n).html(a.data),e.manage._processToolbars()}catch(b){console.log("Error while rendering template:"),console.log(b)}o.loading--})},o.show=function(a){void 0!==a&&(o.manageInfo.templateChooserVisible=a),null!==o.appId&&o.manageInfo.templateChooserVisible&&o.reloadTemplates()},o.toggle=function(){o.manageInfo.someTest="a value",o.manageInfo.templateChooserVisible?o.cancelTemplateChange():(o.show(!0),l.setTemplateChooserState(!0))},o.reload=function(){o.templateId&&(o.manageInfo.isContentApp?o.renderTemplate(o.templateId):h.location.reload())},o.show(),o.manageInfo.isContentApp||l.getSelectableApps().then(function(a){o.apps=a.data,o.apps.push({Name:i.instant("TemplatePicker.GetMoreApps"),AppId:-1})}),o.prepareToAddContent=function(){return o.persistTemplate(!0,!1)},o.addItem=function(a){l.addItem(a).then(function(){o.renderTemplate(o.templateId)})},o.removeFromList=function(a){l.removeFromList(a).then(function(){o.renderTemplate(o.templateId)})},o.changeOrder=function(a,b){l.changeOrder(a,b).then(function(){o.renderTemplate(o.templateId)})},o.publish=function(a,b){l.publish(a,b).then(function(){o.renderTemplate(o.templateId)})},o.translate=function(a){return i.instant(a)}}])}();
//# sourceMappingURL=inpage.min.js.map