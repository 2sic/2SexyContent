/*! ToSic_ToSxc 2015-12-07 */

var $2sxcActionMenuMapper=function(a){return{changeLayoutOrContent:function(){$2sxc(a).manage._getSelectorScope().setTemplateChooserState(!0)},addItem:function(){$2sxc(a).manage.action({action:"add",useModuleList:!0})},edit:function(){$2sxc(a).manage.action({action:"edit",useModuleList:!0,sortOrder:0})},adminApp:function(){$2sxc(a).manage._openNgDialog({action:"app"})},adminZone:function(){$2sxc(a).manage._openNgDialog({action:"zone"})}}};angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("template-selector/template-selector-app.html",'<div ng-cloak ng-show=vm.manageInfo.templateChooserVisible class="dnnFormMessage dnnFormInfo"><div class=sc-selectors><select ng-show=!vm.manageInfo.isContentApp ng-model=vm.appId class=sc-selector-app ng-options="a.AppId as a.Name for a in vm.apps" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option value="" ng-disabled="vm.appId != null" translate=TemplatePicker.AppPickerDefault></option></select><select ng-show=vm.manageInfo.isContentApp ng-model=vm.contentTypeId ng-options="c.StaticName as c.Name for c in vm.contentTypes" class=sc-selector-contenttype ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><select ng-show="vm.manageInfo.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null &&  vm.filteredTemplates().length > 1)" ng-model=vm.templateId class=sc-selector-template ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select></div><div class=sc-selector-actions><a ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" ng-click=vm.saveTemplateId(); class=sc-selector-save title="{{ \'TemplatePicker.Save\' | translate }}">{{ \'TemplatePicker.Save\' | translate }}</a> <a ng-show="vm.savedTemplateId != null" class=sc-selector-close ng-click=vm.setTemplateChooserState(false); title="{{ \'TemplatePicker.Close\' | translate }}">{{ \'TemplatePicker.Close\' | translate }}</a></div><div class="sc-loading sc-loading-nobg" ng-show=vm.loading></div></div>'),a.put("template-selector/template-selector-view.html",'<div ng-cloak ng-show=vm.manageInfo.templateChooserVisible class="dnnFormMessage dnnFormInfo"><div class=sc-selectors><select ng-show=!vm.manageInfo.isContentApp ng-model=vm.appId class=sc-selector-app ng-options="a.AppId as a.Name for a in vm.apps"><option value="" translate=TemplatePicker.AppPickerDefault></option></select><select ng-show=vm.manageInfo.isContentApp ng-model=vm.contentTypeId ng-options="c.StaticName as c.Name for c in vm.contentTypes" class=sc-selector-contenttype ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><select ng-show="vm.manageInfo.isContentApp ? vm.contentTypeId != 0 : vm.savedAppId != null" ng-model=vm.templateId class=sc-selector-template ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select></div><div class=sc-selector-actions><a ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" ng-click=vm.saveTemplateId(); class=sc-selector-save title="{{ \'TemplatePicker.Save\' | translate }}">{{ \'TemplatePicker.Save\' | translate }}</a> <a ng-show="vm.savedTemplateId != null" class=sc-selector-close ng-click=vm.setTemplateChooserState(false); title="{{ \'TemplatePicker.Cancel\' | translate }}">{{ \'TemplatePicker.Cancel\' | translate }}</a></div><div class="sc-loading sc-loading-nobg" ng-show=loading></div></div>')}]),$2sxc.getManageController=function(a){var b=$(".DnnModule-"+a),c=$.parseJSON(b.find("div[data-2sxc]").attr("data-2sxc")).manage,d=$.parseJSON(b.find("div[data-2sxc-globals]").attr("data-2sxc-globals"));c.ngDialogUrl=c.applicationRoot+"desktopmodules/tosic_sexycontent/dist/dnn/ui.html",c.ngDialogParams={zoneId:c.zoneId,appId:c.appId,tid:c.config.tabId,mid:c.config.moduleId,lang:c.lang,langpri:c.langPrimary,langs:JSON.stringify(c.languages),portalroot:d.PortalRoot,websiteroot:c.applicationRoot,approot:c.config&&c.config.appPath?c.config.appPath:null};var e=c.config;e.returnUrl=window.location.href;var f={"default":{icon:"glyphicon-fire",hideFirst:!0,action:function(a,b){alert("not implemented yet")}},edit:{title:"Toolbar.Edit",icon:"glyphicon-pencil",lightbox:!0,hideFirst:!1,action:function(a,b){g._openNgDialog(a,b)}},"new":{title:"Toolbar.New",icon:"glyphicon-plus",lightbox:!0,hideFirst:!1,action:function(a,b){g._openNgDialog($.extend({},a,{sortOrder:a.sortOrder+1}),b)}},add:{title:"Toolbar.AddDemo",icon:"glyphicon-plus-sign",lightbox:!1,hideFirst:!0,action:function(a,b){g._getSelectorScope().addItem(a.sortOrder+1)}},replace:{title:"Toolbar.Replace",icon:"glyphicon-random",lightbox:!0,hideFirst:!0,action:function(a,b){g._openNgDialog(a,b)}},publish:{title:"Toolbar.Published",icon:"glyphicon-eye-open",icon2:"glyphicon-eye-close",lightbox:!1,hideFirst:!0,disabled:!0,action:function(a,b){if(a.isPublished)return void alert("already published");var c=-1==a.sortOrder?"listcontent":"content",d=-1==a.sortOrder?0:a.sortOrder;g._getSelectorScope().publish(c,d)}},moveup:{title:"Toolbar.MoveUp",icon:"glyphicon-arrow-up",icon2:"glyphicon-arrow-up",lightbox:!1,hideFirst:!0,disabled:!1,action:function(a,b){g._getSelectorScope().changeOrder(a.sortOrder,Math.max(a.sortOrder-1,0))}},movedown:{title:"Toolbar.MoveDown",icon:"glyphicon-arrow-down",icon2:"glyphicon-arrow-down",lightbox:!1,hideFirst:!0,disabled:!1,action:function(a,b){g._getSelectorScope().changeOrder(a.sortOrder,a.sortOrder+1)}},sort:{title:"Toolbar.Sort",icon:"glyphicon-th-list",lightbox:!0,hideFirst:!0,action:function(a,b){g._openNgDialog(a,b)}},remove:{title:"Toolbar.Remove",icon:"glyphicon-minus-sign",lightbox:!1,hideFirst:!0,disabled:!0,action:function(a,b){confirm("This will remove this content-item from this list, but not delete it (so you can add it again later). \nSee 2sxc.org/help for more. \n\nOk to remove?")&&g._getSelectorScope().removeFromList(a.sortOrder)}},more:{title:"Toolbar.MoreActions",icon:"glyphicon-option-horizontal",icon2:"glyphicon-option-vertical",borlightboxder:!1,hideFirst:!1,action:function(a,b){$(b.target).parent().find("i").toggleClass(this.icon).toggleClass(this.icon2).closest("ul.sc-menu").toggleClass("showAll")}}},g={isEditMode:function(){return c.isEditMode},_toolbarConfig:e,_manageInfo:c,getNgLink:function(a){a=$.extend({},e,a);var b={dialog:"edit",mode:"new"===a.action?"new":"edit"},d=[];if(a.useModuleList||("new"!==a.action?d.push({EntityId:a.entityId}):(a.contentType||a.attributeSetName)&&d.push({ContentTypeName:a.contentType||a.attributeSetName})),a.useModuleList||"replace"===a.action||"sort"===a.action){var f=-1!==a.sortOrder,h=f?a.sortOrder:0;d.push({Group:{Guid:a.contentGroupId,Index:h,Part:f?"content":"listcontent",Add:"new"===a.action},Title:g._getSelectorScope().translate("EditFormTitle."+(f?"Content":"ListContent"))}),"replace"!==a.action&&d.push({Group:{Guid:a.contentGroupId,Index:h,Part:f?"presentation":"listpresentation",Add:"new"===a.action},Title:g._getSelectorScope().translate("EditFormTitle."+(f?"Presentation":"ListPresentation"))})}if(("replace"===a.action||"app"===a.action||"zone"===a.action||"sort"===a.action)&&(b.dialog=a.action),a.prefill)for(var i=0;i<d.length;i++)d[i].Prefill=a.prefill;return d.length&&(b.items=JSON.stringify(d)),c.ngDialogUrl+"#"+$.param(c.ngDialogParams)+"&"+$.param(b)},_openNgDialog:function(a,b,c){var d=function(){g._getSelectorScope().reload(),c()},e=g.getNgLink(a);b&&b.shiftKey?window.open(e):$2sxc.totalPopup.open(e,d)},action:function(a,b){var c=b||window.event,d=f[a.action]||f["default"];g._getSelectorScope().saveTemplateId().then(function(){d.action(a,c)})},getButton:function(b){b.entity&&b.entity._2sxcEditInformation&&(b.entity._2sxcEditInformation.entityId&&(b.entityId=b.entity._2sxcEditInformation.entityId),null!==b.entity._2sxcEditInformation.sortOrder&&(b.sortOrder=b.entity._2sxcEditInformation.sortOrder,b.useModuleList=!0),delete b.entity);var c=f[b.action]||f["default"],d=$("<a />",{"class":"sc-"+b.action+" "+(b.hideFirst||c.hideFirst?"hideFirst":"")+" "+(c.lightbox?"box":""),onclick:"javascript:$2sxc("+a+").manage.action("+JSON.stringify(b)+", event);",title:g._getSelectorScope().translate(c.title)}),e=$("<div/>"),h=$('<i class="glyphicon '+c.icon+'" aria-hidden="true"></i>');return"publish"===b.action&&b.isPublished===!1&&(d.toggleClass("hideFirst",!1).attr("title","Unpublished"),h.toggleClass(c.icon,!1).toggleClass(c.icon2,!0)),d.html(e.html(h)),d[0].outerHTML},getToolbar:function(a){var b=[];a.action?b=[a]:$.isArray(a)?b=a:(b.push($.extend({},a,{action:"edit"})),e.isList&&-1!==a.sortOrder&&(b.push($.extend({},a,{action:"new"})),a.useModuleList&&(b.push($.extend({},a,{action:"add"})),0!==a.sortOrder&&b.push($.extend({},a,{action:"moveup"})),b.push($.extend({},a,{action:"movedown"}))),b.push($.extend({},a,{action:"sort"}))),b.push($.extend({},a,{action:"publish"})),a.useModuleList&&b.push($.extend({},a,{action:"replace"})),e.isList&&b.push($.extend({},a,{action:"remove"})),b.push($.extend({},a,{action:"more"})));for(var c="sc-menu"+(-1==a.sortOrder?" listContent":""),d=$("<ul />",{"class":c,onclick:"javascript: var e = arguments[0] || window.event; e.stopPropagation();"}),f=0;f<b.length;f++)d.append($("<li />").append($(g.getButton(b[f]))));return d[0].outerHTML},_processToolbars:function(){$(".sc-menu[data-toolbar]",$(".DnnModule-"+a)).each(function(){var b=$.parseJSON($(this).attr("data-toolbar"));$(this).replaceWith($2sxc(a).manage.getToolbar(b))})},_getSelectorScope:function(){var b=document.querySelector(".DnnModule-"+a+" .sc-selector-wrapper");return angular.element(b).scope().vm}};return g},$(document).ready(function(){$(".sc-menu").click(function(a){a.stopPropagation()});var a=$("div[data-2sxc]");window.setTimeout(function(){a.each(function(){var a=$(this).data("2sxc").moduleId;$2sxc(a).manage._processToolbars()})},0),window.EavEditDialogs=[]}),function(){var a=angular.module("2sxc.view",["2sxc4ng","pascalprecht.translate","SxcInpageTemplates","EavConfiguration"]);a.config(["$translateProvider","AppInstanceId","$translatePartialLoaderProvider","languages",function(a,b,c,d){$2sxc(b).manage._manageInfo;a.preferredLanguage(d.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(d.fallbackLanguage).useLoader("$translatePartialLoader",{urlTemplate:d.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("inpage")}]),a.controller("TemplateSelectorCtrl",["$scope","$attrs","moduleApiService","$filter","$q","$window","$translate",function(a,b,c,d,e,f,g){var h=this,i=a,j=b.moduleid,k=c(j);h.manageInfo=$2sxc(j).manage._manageInfo,h.apps=[],h.contentTypes=[],h.templates=[],h.filteredTemplates=function(a){return h.manageInfo.isContentApp?d("filter")(h.templates,"_LayoutElement"==a?{ContentTypeStaticName:""}:{ContentTypeStaticName:a},!0):h.templates},h.contentTypeId=h.manageInfo.contentTypeId,h.templateId=h.manageInfo.templateId,h.savedTemplateId=h.manageInfo.templateId,h.appId=h.manageInfo.appId,h.savedAppId=h.manageInfo.appId,h.loading=0,h.reloadTemplates=function(){h.loading++;var a=k.getSelectableContentTypes(),b=k.getSelectableTemplates();e.all([a,b]).then(function(a){h.contentTypes=a[0].data,h.templates=a[1].data,d("filter")(h.templates,{ContentTypeStaticName:""},!0).length>0&&(h.contentTypes.push({StaticName:"_LayoutElement",Name:"Layout element"}),h.contentTypes=d("orderBy")(h.contentTypes,"Name")),h.loading--})},h.reload=function(){h.templateId&&(h.manageInfo.isContentApp?h.renderTemplate(h.templateId):f.location.reload())},i.$watch("vm.templateId",function(a,b){if(a!=b)if(h.manageInfo.isContentApp)h.renderTemplate(a);else{h.loading++;var c;c=h.manageInfo.hasContent?h.saveTemplateId(a):h.setPreviewTemplateId(a),c.then(function(){f.location.reload()})}}),i.$watch("vm.contentTypeId",function(a,b){if(a!=b){var c=h.filteredTemplates(a)[0].TemplateId;h.templateId!==c&&null!==c&&(h.templateId=c)}}),null!==h.appId&&h.manageInfo.templateChooserVisible&&h.reloadTemplates(),i.$watch("vm.manageInfo.templateChooserVisible",function(a,b){a!==b&&null!==h.appId&&a&&h.reloadTemplates()}),i.$watch("vm.appId",function(a,c){return a!==c&&null!==a?-1==a?void(window.location=b.importappdialog):void k.setAppId(a).then(function(){f.location.reload()}):void 0}),h.manageInfo.isContentApp||k.getSelectableApps().then(function(a){h.apps=a.data,h.apps.push({Name:b.importapptext,AppId:-1})}),h.setTemplateChooserState=function(a){return a||(h.templateId=h.savedTemplateId),k.setTemplateChooserState(a).then(function(){h.manageInfo.templateChooserVisible=a})},h.saveTemplateId=function(){var a=[];return h.manageInfo.hasContent&&h.savedTemplateId==h.templateId||(a.push(k.saveTemplateId(h.templateId).then(function(a){var b=a.data;$2sxc(j).manage._manageInfo.config.contentGroupId=b})),h.savedTemplateId=h.templateId,a.push(h.setTemplateChooserState(!1))),e.all(a)},h.setPreviewTemplateId=function(){return k.setPreviewTemplateId(h.templateId)},h.renderTemplate=function(a){h.loading++,k.renderTemplate(a).then(function(a){try{h.insertRenderedTemplate(a.data),$2sxc(j).manage._processToolbars()}catch(b){console.log("Error while rendering template:"),console.log(b)}h.loading--})},h.insertRenderedTemplate=function(a){$(".DnnModule-"+j+" .sc-viewport").html(a)},h.addItem=function(a){k.addItem(a).then(function(){h.renderTemplate(h.templateId)})},h.removeFromList=function(a){k.removeFromList(a).then(function(){h.renderTemplate(h.templateId)})},h.changeOrder=function(a,b){k.changeOrder(a,b).then(function(){h.renderTemplate(h.templateId)})},h.publish=function(a,b){k.publish(a,b).then(function(){h.renderTemplate(h.templateId)})},h.translate=function(a){return g.instant(a)}}]),a.factory("moduleApiService",["$http",function(a){return function(b){function c(b,c){return a(c)}return{saveTemplateId:function(a){return c(b,{url:"View/Module/SaveTemplateId",params:{templateId:a}})},setPreviewTemplateId:function(a){return c(b,{url:"View/Module/SetPreviewTemplateId",params:{templateId:a}})},addItem:function(a){return c(b,{url:"View/Module/AddItem",params:{sortOrder:a}})},getSelectableApps:function(){return c(b,{url:"View/Module/GetSelectableApps"})},setAppId:function(a){return c(b,{url:"View/Module/SetAppId",params:{appId:a}})},getSelectableContentTypes:function(){return c(b,{url:"View/Module/GetSelectableContentTypes"})},getSelectableTemplates:function(){return c(b,{url:"View/Module/GetSelectableTemplates"})},setTemplateChooserState:function(a){return c(b,{url:"View/Module/SetTemplateChooserState",params:{state:a}})},renderTemplate:function(a){return c(b,{url:"View/Module/RenderTemplate",params:{templateId:a}})},changeOrder:function(a,d){return c(b,{url:"View/Module/ChangeOrder",params:{sortOrder:a,destinationSortOrder:d}})},publish:function(a,d){return c(b,{url:"view/module/publish",params:{part:a,sortOrder:d}})},removeFromList:function(a){return c(b,{url:"View/Module/RemoveFromList",params:{sortOrder:a}})}}}}])}();
//# sourceMappingURL=inpage.min.js.map