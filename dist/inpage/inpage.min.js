function processInstallMessage(a,b){var c=/^(http|https):\/\/((gettingstarted|[a-z]*)\.)?(2sexycontent|2sxc)\.org(\/.*)?$/gi;if(!c.test(a.origin))return void console.error("can't execute, wrong source domain");var d=JSON.parse(a.data);if(d.moduleId===b)if("install"===d.action){for(var e=$.ServicesFramework(b),f=d.packages,g="",h=0;h<f.length;h++)g+="- "+f[h].displayName+"\n";if(confirm("Do you want to install these packages?\n\n"+g+"\nThis could take 10 to 60 seconds per package, please don't reload the page while it's installing. You will see a message once it's done and progess is logged to the JS-console.")){$(".DnnModule-"+b+" #pnlLoading").show();var i=$(".DnnModule-"+b+" #packageName");i.html("..."),runOneInstallJob(f,0,e,i)}}else"resize"===d.action&&resizeIFrame(b,d.height)}function resizeIFrame(a,b){$(".DnnModule-"+a+" #frGettingStarted").height(b)}function runOneInstallJob(a,b,c,d){var e=a[b];return console.log(e.displayName+"("+b+") started"),d.html(e.displayName),$.ajax({type:"GET",dataType:"json",async:!0,url:c.getServiceRoot("2sxc")+"Installer/InstallPackage",data:"packageUrl="+e.url,beforeSend:c.setModuleHeaders}).complete(function(f,g){console.log(e.displayName+"("+b+") completed"),b+1<a.length?runOneInstallJob(a,b+1,c,d):(alert("Done installing. If you saw no errors, everything worked."),window.location.reload())}).error(function(a,b,c){var d="Something went wrong while installing '"+e.displayName+"': "+c;if(a.responseText&&""!==a.responseText){var f=$.parseJSON(a.responseText);f.messages?d=d+" - "+f.messages[0].Message:f.Message&&(d=d+" - "+f.Message)}d+=" (you might find more informations about the error in the DNN event log).",alert(d)})}!function(){$2sxc._lib={extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}}}();var $2sxcActionMenuMapper=function(a){return{changeLayoutOrContent:function(){$2sxc(a).manage.action({action:"layout"})},addItem:function(){$2sxc(a).manage.action({action:"add",useModuleList:!0,sortOrder:0})},edit:function(){$2sxc(a).manage.action({action:"edit",useModuleList:!0,sortOrder:0})},adminApp:function(){$2sxc(a).manage.action({action:"app"})},adminZone:function(){$2sxc(a).manage.action({action:"zone"})},develop:function(){$2sxc(a).manage.action({action:"develop"})}}};angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("template-selector/template-selector.html",'<div ng-cloak ng-show=vm.manageInfo.templateChooserVisible class="dnnFormMessage dnnFormInfo"><div class=sc-selectors><select ng-show=!vm.manageInfo.isContentApp ng-model=vm.appId class=sc-selector-app ng-options="a.AppId as (a.Name.indexOf(\'TemplatePicker.\') === 0 ? (a.Name | translate) : a.Name) for a in vm.apps" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option value="" ng-disabled="vm.appId != null" translate=TemplatePicker.AppPickerDefault></option></select><select ng-show=vm.manageInfo.isContentApp ng-model=vm.contentTypeId class=sc-selector-contenttype ng-options="c.StaticName as c.Name for c in vm.contentTypes" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><select ng-show="vm.manageInfo.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null &&  vm.filteredTemplates().length > 1)" ng-model=vm.templateId class=sc-selector-template ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select></div><div class=sc-selector-actions>&nbsp; <a ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" class=sc-selector-save ng-click="vm.persistTemplate(false, false);" title="{{ \'TemplatePicker.Save\' | translate }}"><div><i class=icon-sxc-ok></i></div></a> &nbsp; <a ng-show="vm.undoTemplateId != null" class=sc-selector-close ng-click=vm.cancelTemplateChange(); title="{{ \'TemplatePicker.\' + (vm.manageInfo.isContentApp ? \'Cancel\' : \'Close\') | translate }}"><div><i class=icon-sxc-cancel></i></div></a></div><div class=sc-loading ng-show=vm.loading><i class="icon-sxc-spinner fa-spin"></i></div><div style="position: relative" ng-if=vm.showRemoteInstaller><iframe id=frGettingStarted ng-src={{vm.remoteInstallerUrl}} width=100% height=300px></iframe><div class=sc-loading id=pnlLoading style=display:none><i class="icon-sxc-spinner animate-spin"></i><br><br><span class=sc-loading-label>installing <span id=packageName>.</span></span></div></div></div>')}]),function(){function a(a,b,c,d,e,f){return $2sxc._lib.extend({name:a,title:"Toolbar."+b,iclass:"icon-sxc-"+c,showOn:d,uiActionOnly:e},f)}$2sxc._actions={},$2sxc._actions.create=function(b,c,d,e,f){var g={edit:a("edit","Edit","pencil","default",!1,{params:{mode:"edit"}}),"new":a("new","New","plus","default",!1,{params:{mode:"new"},dialog:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c._openNgDialog(extend({},a,{sortOrder:a.sortOrder+1}),b)}}),add:a("add","AddDemo","plus-circled","edit",!1,{addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c._getAngularVm().addItem(a.sortOrder+1)}}),metadata:a("metadata","Metadata","tag","default",!1,{params:{mode:"new"},dialog:"edit",dynamicClasses:function(a){return a.entityId?"":"empty"},addCondition:function(a){return!!a.metadata},configureCommand:function(a){var b={Title:"EditFormTitle.Metadata",Metadata:extend({keyType:"string",targetType:10},a.settings.metadata)};extend(a.items[0],b)}}),remove:{title:"Toolbar.Remove",iclass:"icon-sxc-minus-circled",disabled:!0,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b){confirm(tbContr.translate("Toolbar.ConfirmRemove"))&&tbContr._getAngularVm().removeFromList(a.sortOrder)}},moveup:{title:"Toolbar.MoveUp",iclass:"icon-sxc-move-up",disabled:!1,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder&&0!==a.sortOrder},code:function(a,b,c){c._getAngularVm().changeOrder(a.sortOrder,Math.max(a.sortOrder-1,0))}},movedown:{title:"Toolbar.MoveDown",iclass:"icon-sxc-move-down",disabled:!1,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c._getAngularVm().changeOrder(a.sortOrder,a.sortOrder+1)}},sort:{title:"Toolbar.Sort",iclass:"icon-sxc-list-numbered",showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder}},publish:a("publish","Published","eye","edit",!1,{iclass2:"icon-sxc-eye-off",disabled:!0,code:function(a,b,c){if(a.isPublished)return void alert(c.translate("Toolbar.AlreadyPublished"));var d=-1===a.sortOrder?"listcontent":"content",e=-1===a.sortOrder?0:a.sortOrder;c._getAngularVm().publish(d,e)}}),replace:a("replace","Replace","replace","edit",!1,{addCondition:function(a){return a.useModuleList}}),layout:{title:"Toolbar.ChangeLayout",iclass:"icon-sxc-glasses",showOn:"default",uiActionOnly:!0,code:function(a,b,c){c._getAngularVm().toggle()}},develop:a("develop","Develop","code","admin",!0,{newWindow:!0,addCondition:b,configureCommand:function(a){a.items=[{EntityId:manageInfo.templateId}]}}),contenttype:{title:"Toolbar.ContentType",iclass:"icon-sxc-fields",showOn:"admin",uiActionOnly:!0,addCondition:b},contentitems:{title:"Toolbar.ContentItems",iclass:"icon-sxc-table",showOn:"admin",params:{contentTypeName:f},uiActionOnly:!0,addCondition:b&&f},app:{title:"Toolbar.App",iclass:"icon-sxc-settings",showOn:"admin",uiActionOnly:!0,addCondition:b},zone:{title:"Toolbar.Zone",iclass:"icon-sxc-manage",showOn:"admin",uiActionOnly:!0,addCondition:b},more:{title:"Toolbar.MoreActions",iclass:"icon-sxc-options btn-mode",showOn:"default,edit,design,admin",uiActionOnly:!0,code:function(a,c,d){var e=$(c.target).closest("ul.sc-menu"),f=Number(e.attr("data-state")||0),g=f+1;2===g&&(g=3),g%=b?4:3,e.removeClass("show-set-"+f).addClass("show-set-"+g).attr("data-state",g)}}};return g}}(),$2sxc.getManageController=function(a){var b=$2sxc._lib.extend,c=$(".DnnModule-"+a),d=$.parseJSON(c.find("div[data-2sxc]").attr("data-2sxc")).manage,e=$.parseJSON(c.find("div[data-2sxc-globals]").attr("data-2sxc-globals"));d.ngDialogUrl=d.applicationRoot+"desktopmodules/tosic_sexycontent/dist/dnn/ui.html?sxcver="+d.config.version,d.ngDialogParams={zoneId:d.zoneId,appId:d.appId,tid:d.config.tabId,mid:d.config.moduleId,lang:d.lang,langpri:d.langPrimary,langs:JSON.stringify(d.languages),portalroot:e.PortalRoot,websiteroot:d.applicationRoot,user:d.user,approot:d.config&&d.config.appPath?d.config.appPath:null};var f=d.contentTypeId,g=d.config;g.contentType=g.contentType||g.attributeSetName;var h=d.user.canDesign,i=d.user.canDevelop,j=d.isContentApp,k=$2sxc.urlParams.get("debug")?"&debug=true":"",l=$2sxc._actions.create(h,i,j,k,f),m={isEditMode:function(){return d.isEditMode},_toolbarConfig:g,_manageInfo:d,createCommandObject:function(a){var c=b({},g,a),e={settings:c,items:c.items||[],params:b({dialog:c.dialog||c.action},c.params),addSimpleItem:function(){var a={},b=e.settings.contentType||e.settings.attributeSetName;e.settings.entityId&&(a.EntityId=e.settings.entityId),b&&(a.ContentTypeName=b),(a.EntityId||a.ContentTypeName)&&e.items.push(a)},addContentGroupItem:function(a,b,c,d,f){e.items.push({Group:{Guid:a,Index:b,Part:c,Add:d},Title:m.translate(f)})},addContentGroupItemSetsToEditList:function(a){var b=-1!==e.settings.sortOrder,c=b?e.settings.sortOrder:0,d=b?"":"List",f=d+"Content",g=d+"Presentation",h="new"===e.settings.action,i=e.settings.contentGroupId;e.addContentGroupItem(i,c,f.toLowerCase(),h,"EditFormTitle."+f),a&&e.addContentGroupItem(i,c,g.toLowerCase(),h,"EditFormTitle."+g)},generateLink:function(){if(e.settings.items||(e.settings.items=[]),e.settings.prefill)for(var a=0;a<e.items.length;a++)e.items[a].Prefill=e.settings.prefill;return e.params.items=JSON.stringify(e.items),d.ngDialogUrl+"#"+$.param(d.ngDialogParams)+"&"+$.param(e.params)+k}};return e},getNgLink:function(a){var b=m.createCommandObject(a);return b.settings.useModuleList?b.addContentGroupItemSetsToEditList(!0):b.addSimpleItem(),b.settings.configureCommand&&b.settings.configureCommand(b),b.generateLink()},_openNgDialog:function(a,b,c){var d=function(){m._getAngularVm().reload(),c()},e=m.getNgLink(a);a.newWindow||b&&b.shiftKey?window.open(e):$2sxc.totalPopup.open(e,d)},action:function(a,c){var d=l[a.action];a=b({},d,a),a.dialog||(a.dialog=a.action),a.code||(a.code=m._openNgDialog);var e=c||window.event;return d.uiActionOnly?a.code(a,e,m):void m._getAngularVm().prepareToAddContent().then(function(){return a.code(a,e,m)})},getButton:function(b){b.entity&&b.entity._2sxcEditInformation&&(b.entity._2sxcEditInformation.entityId&&(b.entityId=b.entity._2sxcEditInformation.entityId,b.useModuleList=!1),b.entity._2sxcEditInformation.sortOrder&&(b.sortOrder=b.entity._2sxcEditInformation.sortOrder,b.useModuleList=!0),delete b.entity);for(var c=l[b.action],d="",e=c.showOn.split(","),f=0;f<e.length;f++)d+=" show-"+e[f];var g=$("<a />",{"class":"sc-"+b.action+" "+d+(c.dynamicClasses?" "+c.dynamicClasses(b):""),onclick:"javascript:$2sxc("+a+").manage.action("+JSON.stringify(b)+", event);",title:m.translate(c.title)}),h=$("<div/>"),i=$('<i class="'+c.iclass+'" aria-hidden="true"></i>');return"publish"===b.action&&b.isPublished===!1&&(g.addClass("show-default").removeClass("show-edit").attr("title",m.translate("Toolbar.Unpublished")),i.removeClass(c.iclass).addClass(c.iclass2)),g.html(h.html(i)),g[0].outerHTML},getToolbar:function(a){for(var b=a.action?[a]:$.isArray(a)?a:m.createDefaultToolbar(a),c="sc-menu show-set-0"+(-1===a.sortOrder?" listContent":""),d=$("<ul />",{"class":c,onclick:"javascript: var e = arguments[0] || window.event; e.stopPropagation();"}),e=0;e<b.length;e++)d.append($("<li />").append($(m.getButton(b[e]))));return d[0].outerHTML},createDefaultToolbar:function(a){var c=[];c.add=function(d){var e=l[d].addCondition;(void 0===e||("function"==typeof e?e(a,g):e))&&c.push(b({},a,{action:d}))};for(var d in l)l.hasOwnProperty(d)&&c.add(d);return c},_processToolbars:function(){$(".sc-menu[data-toolbar]",$(".DnnModule-"+a)).each(function(){var b=$.parseJSON($(this).attr("data-toolbar"));$(this).replaceWith($2sxc(a).manage.getToolbar(b))})},_getAngularVm:function(){var b=document.querySelector(".DnnModule-"+a+" .sc-selector-wrapper");return angular.element(b).scope().vm},translate:function(a){return m._getAngularVm().translate(a)}};return m},$(document).ready(function(){$(".sc-menu").click(function(a){a.stopPropagation()});var a=$("div[data-2sxc]");window.setTimeout(function(){a.each(function(){try{var a=$(this).data("2sxc").moduleId;$2sxc(a).manage._processToolbars()}catch(b){console&&console.error&&console.error(b)}})},0),window.EavEditDialogs=[]}),function(){var a=angular.module("2sxc.view",["2sxc4ng","pascalprecht.translate","SxcInpageTemplates","EavConfiguration"]);a.config(["$translateProvider","AppInstanceId","$translatePartialLoaderProvider","languages",function(a,b,c,d){$2sxc(b).manage._manageInfo;a.preferredLanguage(d.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(d.fallbackLanguage).useLoader("$translatePartialLoader",{urlTemplate:d.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("inpage")}])}(),function(){var a=angular.module("2sxc.view");a.factory("moduleApiService",["$http",function(a){return{saveTemplate:function(b,c,d){return a.get("View/Module/SaveTemplateId",{params:{templateId:b,forceCreateContentGroup:c,newTemplateChooserState:d}})},addItem:function(b){return a.get("View/Module/AddItem",{params:{sortOrder:b}})},getSelectableApps:function(){return a.get("View/Module/GetSelectableApps")},setAppId:function(b){return a.get("View/Module/SetAppId",{params:{appId:b}})},getSelectableContentTypes:function(){return a.get("View/Module/GetSelectableContentTypes")},getSelectableTemplates:function(){return a.get("View/Module/GetSelectableTemplates")},setTemplateChooserState:function(b){return a.get("View/Module/SetTemplateChooserState",{params:{state:b}})},renderTemplate:function(b,c){return a.get("View/Module/RenderTemplate",{params:{templateId:b,lang:c}})},changeOrder:function(b,c){return a.get("View/Module/ChangeOrder",{params:{sortOrder:b,destinationSortOrder:c}})},publish:function(b,c){return a.get("view/module/publish",{params:{part:b,sortOrder:c}})},removeFromList:function(b){return a.get("View/Module/RemoveFromList",{params:{sortOrder:b}})},gettingStartedUrl:function(){return a.get("View/Module/RemoteInstallDialogUrl",{params:{dialog:"gettingstarted"}})}}}])}(),function(){var a=angular.module("2sxc.view");a.controller("TemplateSelectorCtrl",["$scope","$attrs","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate","$sce",function(a,b,c,d,e,f,g,h,i,j){var k="_LayoutElement",l=-2,m=-1,n=-3,o=".DnnModule-"+d+" .sc-viewport",p=a,q=c,r=b.importappdialog,s=this;s.apps=[],s.contentTypes=[],s.templates=[],s.manageInfo=e.manage._manageInfo,s.templateId=s.manageInfo.templateId,s.undoTemplateId=s.templateId,s.contentTypeId=""===s.manageInfo.contentTypeId&&null!==s.manageInfo.templateId?k:s.manageInfo.contentTypeId,s.undoContentTypeId=s.contentTypeId,s.appId=s.manageInfo.appId,s.savedAppId=s.manageInfo.appId,s.showRemoteInstaller=!1,s.remoteInstallerUrl="",s.loading=0,s.filteredTemplates=function(a){if(!s.manageInfo.isContentApp)return s.templates;var b={ContentTypeStaticName:a===k?"":a};return f("filter")(s.templates,b,!0)},s.reloadTemplates=function(){s.loading++;var a=q.getSelectableContentTypes(),b=q.getSelectableTemplates();return g.all([a,b]).then(function(a){s.contentTypes=a[0].data,s.templates=a[1].data,f("filter")(s.templates,{ContentTypeStaticName:""},!0).length>0&&(s.contentTypes.push({StaticName:k,Name:i.instant("TemplatePicker.LayoutElement")}),s.contentTypes=f("orderBy")(s.contentTypes,"Name")),s.loading--})},p.$watch("vm.templateId",function(a,b){if(a!==b){if(s.manageInfo.isContentApp)return s.renderTemplate(a);s.loading++,s.persistTemplate(!1).then(function(){h.location.reload()})}}),p.$watch("vm.contentTypeId",function(a,b){if(a!=b){var c=s.filteredTemplates(a)[0].TemplateId;s.templateId!==c&&null!==c&&(s.templateId=c)}}),p.$watch("vm.appId",function(a,b){return a!==b&&null!==a?a===l?void e.manage.action({action:"zone"}):a===n?(alert("click + in the app-management to create your own app"),void e.manage.action({action:"zone"})):a===m?void(window.location=r):void q.setAppId(a).then(function(){h.location.reload()}):void 0}),s.cancelTemplateChange=function(){s.templateId=s.undoTemplateId,s.contentTypeId=s.undoContentTypeId,s.manageInfo.templateChooserVisible=!1,q.setTemplateChooserState(!1),s.manageInfo.isContentApp&&s.reloadTemplates()},s.persistTemplate=function(a,b){var c,d=!!s.manageInfo.hasContent&&s.undoTemplateId===s.templateId;c=d?s.manageInfo.templateChooserVisible?q.setTemplateChooserState(!1):g.when(null):q.saveTemplate(s.templateId,a,b).then(function(a){if(200!==a.status)return void alert("error - result not ok, was not able to create ContentGroup");var b=a.data;null!==b&&(b=b.replace(/[\",\']/g,""),console&&console.log("created content group {"+b+"}"),e.manage._manageInfo.config.contentGroupId=b)});var f=c.then(function(){s.undoTemplateId=s.templateId,s.undoContentTypeId=s.contentTypeId,s.manageInfo.templateChooserVisible=!1,s.manageInfo.hasContent||(s.manageInfo.hasContent=a)});return f},s.renderTemplate=function(a){s.loading++,q.renderTemplate(a,s.manageInfo.lang).then(function(a){try{$(o).html(a.data),e.manage._processToolbars()}catch(b){console.log("Error while rendering template:"),console.log(b)}s.loading--})},s.show=function(a){if(void 0!==a&&(s.manageInfo.templateChooserVisible=a),s.manageInfo.templateChooserVisible){var b=[];null!==s.appId&&b.push(s.reloadTemplates()),s.manageInfo.isContentApp||0!==s.apps.length||b.push(s.loadApps()),g.all(b).then(s.externalInstaller.showIfConfigIsEmpty)}},s.externalInstaller={showIfConfigIsEmpty:function(){var a=s.manageInfo.isContentApp?0===s.templates.length:s.apps.length<=1;a&&s.externalInstaller.setup()},configureCallback:function(){window.addEventListener("message",function(a){processInstallMessage(a,d)},!1)},setup:function(){q.gettingStartedUrl().then(function(a){s.externalInstaller.configureCallback(),s.showRemoteInstaller=!0,s.remoteInstallerUrl=j.trustAsResourceUrl(a.data),console.log(a.data)})}},s.toggle=function(){s.manageInfo.someTest="a value",s.manageInfo.templateChooserVisible?s.cancelTemplateChange():(s.show(!0),q.setTemplateChooserState(!0))},s.reload=function(){s.templateId&&(s.manageInfo.isContentApp?s.renderTemplate(s.templateId):h.location.reload())},s.loadApps=function(){return q.getSelectableApps().then(function(a){s.apps=a.data,s.manageInfo.user.canDesign&&(s.apps.push({Name:"TemplatePicker.GetMoreApps",AppId:m}),s.apps.push({Name:"create your own app...",AppId:n}),s.apps.push({Name:"manage apps...",AppId:l}))})},s.activate=function(){s.show()},s.activate(),s.prepareToAddContent=function(){return s.persistTemplate(!0,!1)},s.addItem=function(a){q.addItem(a).then(function(){s.renderTemplate(s.templateId)})},s.removeFromList=function(a){q.removeFromList(a).then(function(){s.renderTemplate(s.templateId)})},s.reallyDelete=function(a){alert("Really delete not implemented yet - would delete: "+a)},s.changeOrder=function(a,b){q.changeOrder(a,b).then(function(){s.renderTemplate(s.templateId)})},s.publish=function(a,b){q.publish(a,b).then(function(){s.renderTemplate(s.templateId)})},s.translate=function(a){return i.instant(a)}}])}();
//# sourceMappingURL=inpage.min.js.map