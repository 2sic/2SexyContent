!function(){function a(a,b,c,d,e,f){return $2sxc._lib.extend({name:a,title:"Toolbar."+b,iclass:"icon-sxc-"+c,showOn:d,uiActionOnly:e},f)}$2sxc._actions={};$2sxc._actions.create=function(b){var c=b.canDesign,d={"dash-view":a("dash","Dashboard","","",!0,{inlineWindow:!0}),edit:a("edit","Edit","pencil","default",!1,{params:{mode:"edit"}}),"new":a("new","New","plus","default",!1,{params:{mode:"new"},dialog:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c._openNgDialog($2sxc._lib.extend({},a,{sortOrder:a.sortOrder+1}),b)}}),add:a("add","AddDemo","plus-circled","edit",!1,{addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c.contentBlock.addItem(a.sortOrder+1)}}),metadata:a("metadata","Metadata","tag","default",!1,{params:{mode:"new"},dialog:"edit",dynamicClasses:function(a){return a.entityId?"":"empty"},addCondition:function(a){return!!a.metadata},configureCommand:function(a){var b={Title:"EditFormTitle.Metadata",Metadata:$2sxc._lib.extend({keyType:"string",targetType:10},a.settings.metadata)};$2sxc._lib.extend(a.items[0],b)}}),remove:{title:"Toolbar.Remove",iclass:"icon-sxc-minus-circled",disabled:!0,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){confirm($2sxc.translate("Toolbar.ConfirmRemove"))&&c.contentBlock.removeFromList(a.sortOrder)}},moveup:{title:"Toolbar.MoveUp",iclass:"icon-sxc-move-up",disabled:!1,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder&&0!==a.sortOrder},code:function(a,b,c){c.contentBlock.changeOrder(a.sortOrder,Math.max(a.sortOrder-1,0))}},movedown:{title:"Toolbar.MoveDown",iclass:"icon-sxc-move-down",disabled:!1,showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder},code:function(a,b,c){c.contentBlock.changeOrder(a.sortOrder,a.sortOrder+1)}},sort:{title:"Toolbar.Sort",iclass:"icon-sxc-list-numbered",showOn:"edit",addCondition:function(a,b){return b.isList&&a.useModuleList&&-1!==a.sortOrder}},publish:a("publish","Published","eye","edit",!1,{iclass2:"icon-sxc-eye-off",disabled:!0,code:function(a,b,c){if(a.isPublished)return void alert($2sxc.translate("Toolbar.AlreadyPublished"));var d=-1===a.sortOrder?"listcontent":"content",e=-1===a.sortOrder?0:a.sortOrder;c.contentBlock.publish(d,e)}}),replace:a("replace","Replace","replace","edit",!1,{addCondition:function(a){return a.useModuleList}}),layout:{title:"Toolbar.ChangeLayout",iclass:"icon-sxc-glasses",showOn:"default",uiActionOnly:!0,code:function(a,b,c){c.contentBlock.dialogToggle()}},develop:a("develop","Develop","code","admin",!0,{newWindow:!0,addCondition:c,configureCommand:function(a){a.items=[{EntityId:b.templateId}]}}),contenttype:{title:"Toolbar.ContentType",iclass:"icon-sxc-fields",showOn:"admin",uiActionOnly:!0,addCondition:c},contentitems:{title:"Toolbar.ContentItems",iclass:"icon-sxc-table",showOn:"admin",params:{contentTypeName:b.contentTypeId},uiActionOnly:!0,addCondition:c&&b.contentTypeId},app:{title:"Toolbar.App",iclass:"icon-sxc-settings",showOn:"admin",uiActionOnly:!0,addCondition:c},zone:{title:"Toolbar.Zone",iclass:"icon-sxc-manage",showOn:"admin",uiActionOnly:!0,addCondition:c},more:{title:"Toolbar.MoreActions",iclass:"icon-sxc-options btn-mode",showOn:"default,edit,design,admin",uiActionOnly:!0,code:function(a,b,d){var e=$(b.target).closest("ul.sc-menu"),f=Number(e.attr("data-state")||0),g=f+1;2===g&&(g=3),g%=c?4:3,e.removeClass("show-set-"+f).addClass("show-set-"+g).attr("data-state",g)}}};return d}}(),function(){$2sxc._contentManagementCommands=function(a,b){var c={editManager:"must-be-added-after-initialization",init:function(a){c.editManager=a},create:function(a){var b=$2sxc._lib.extend({},c.editManager.toolbarConfig,a),d=c.editManager.editContext.Environment.SxcRootUrl+"desktopmodules/tosic_sexycontent/dist/dnn/ui.html?sxcver="+c.editManager.editContext.Environment.SxcVersion,e=$2sxc.urlParams.get("debug")?"&debug=true":"",f={settings:b,items:b.items||[],params:$2sxc._lib.extend({dialog:b.dialog||b.action},b.params),addSimpleItem:function(){var a={},b=f.settings.contentType||f.settings.attributeSetName;f.settings.entityId&&(a.EntityId=f.settings.entityId),b&&(a.ContentTypeName=b),(a.EntityId||a.ContentTypeName)&&f.items.push(a)},addContentGroupItem:function(a,b,c,d,e,g,h){f.items.push({Group:{Guid:a,Index:b,Part:c,Add:d},Title:$2sxc.translate(h)})},addContentGroupItemSetsToEditList:function(a){var b=-1!==f.settings.sortOrder,c=b?f.settings.sortOrder:0,d=b?"":"List",e=d+"Content",g=d+"Presentation",h="new"===f.settings.action,i=f.settings.contentGroupId;f.addContentGroupItem(i,c,e.toLowerCase(),h,f.settings.cbIsEntity,f.settings.cbId,"EditFormTitle."+e),a&&f.addContentGroupItem(i,c,g.toLowerCase(),h,f.settings.cbIsEntity,f.settings.cbId,"EditFormTitle."+g)},generateLink:function(){if(f.settings.items||(f.settings.items=[]),f.settings.prefill)for(var a=0;a<f.items.length;a++)f.items[a].Prefill=f.settings.prefill;return f.params.items=JSON.stringify(f.items),d+"#"+$.param(c.editManager.dialogParameters)+"&"+$.param(f.params)+e}};return f},_linkToNgDialog:function(a){var b=c.editManager.commands.create(a);return b.settings.useModuleList?b.addContentGroupItemSetsToEditList(!0):b.addSimpleItem(),b.settings.configureCommand&&b.settings.configureCommand(b),b.generateLink()},_openNgDialog:function(d,e,f){var g=function(){c.editManager.contentBlock.reloadAndReInitialize(),f()},h=c._linkToNgDialog(d);return d.newWindow||e&&e.shiftKey?window.open(h):d.inlineWindow?$2sxc._dialog.create(a,b,h,g):$2sxc.totalPopup.open(h,g)},executeAction:function(a,b){var d=c.editManager.toolbar.actions[a.action];a=$2sxc._lib.extend({},d,a),a.dialog||(a.dialog=a.action),a.code||(a.code=c._openNgDialog);var e=b||window.event;return d.uiActionOnly?a.code(a,e,c.editManager):void c.editManager.contentBlock.prepareToAddContent().then(function(){return a.code(a,e,c.editManager)})}};return c}}(),function(){$2sxc._lib={extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}}}(),function(){$2sxc._toolbarManager=function(a,b){function c(){var a={portalId:b.Environment.WebsiteId,tabId:b.Environment.PageId,moduleId:b.Environment.InstanceId,version:b.Environment.SxcVersion,contentGroupId:b.ContentGroup.Guid,cbIsEntity:b.ContentBlock.IsEntity,cbId:b.ContentBlock.Id,appPath:b.ContentGroup.AppUrl,isList:b.ContentGroup.IsList};return a}var d=a.id,e=a.cbid,f={canDesign:b.User.CanDesign,templateId:b.ContentGroup.TemplateId,contentTypeId:b.ContentGroup.ContentTypeName},g=$2sxc._actions.create(f),h={config:c(),refreshConfig:function(){h.config=c()},actions:g,getButton:function(a){a.entity&&a.entity._2sxcEditInformation&&(a.entity._2sxcEditInformation.entityId&&(a.entityId=a.entity._2sxcEditInformation.entityId,a.useModuleList=!1),a.entity._2sxcEditInformation.sortOrder&&(a.sortOrder=a.entity._2sxcEditInformation.sortOrder,a.useModuleList=!0),delete a.entity);for(var b=g[a.action],c="",f=b.showOn.split(","),h=$("<div/>"),i=$('<i class="'+b.iclass+'" aria-hidden="true"></i>'),j=0;j<f.length;j++)c+=" show-"+f[j];var k=$("<a />",{"class":"sc-"+a.action+" "+c+(b.dynamicClasses?" "+b.dynamicClasses(a):""),onclick:"javascript:$2sxc("+d+", "+e+").manage.action("+JSON.stringify(a)+", event);",title:$2sxc.translate(b.title)});return"publish"===a.action&&a.isPublished===!1&&(k.addClass("show-default").removeClass("show-edit").attr("title",$2sxc.translate("Toolbar.Unpublished")),i.removeClass(b.iclass).addClass(b.iclass2)),k.html(h.html(i)),k[0].outerHTML},createDefaultToolbar:function(a){var b=[];b.add=function(c){var d=g[c].addCondition;(void 0===d||("function"==typeof d?d(a,h.config):d))&&b.push($2sxc._lib.extend({},a,{action:c}))};for(var c in g)g.hasOwnProperty(c)&&b.add(c);return b},getToolbar:function(a){for(var b=a.action?[a]:$.isArray(a)?a:h.createDefaultToolbar(a),c="sc-menu show-set-0"+(-1===a.sortOrder?" listContent":""),d=$("<ul />",{"class":c,onclick:"javascript: var e = arguments[0] || window.event; e.stopPropagation();"}),e=0;e<b.length;e++)d.append($("<li />").append($(h.getButton(b[e]))));return d[0].outerHTML},_processToolbars:function(a){a=a?$(a):$(".DnnModule-"+d),$(".sc-menu[data-toolbar]",a).each(function(){var a=$.parseJSON($(this).attr("data-toolbar")),b=$(this);b.replaceWith($2sxc(b).manage.getToolbar(a))})}};return h}}(),$2sxc.contentBlock=function(a,b,c){var d="_LayoutElement",e=b.editContext,f=""===e.ContentGroup.ContentTypeName&&null!==e.ContentGroup.TemplateId?d:e.ContentGroup.ContentTypeName,g={sxc:a,editContext:e,templateId:e.ContentGroup.TemplateId,undoTemplateId:e.ContentGroup.TemplateId,contentTypeId:f,undoContentTypeId:f,replace:function(a,b){try{var d=$(a);$(c).replaceWith(d),c=d}catch(e){console.log("Error while rendering template:"),console.log(e)}},replacePreview:function(a){g.replace(a,!0)},reloadAndReInitialize:function(){return b.reloadWithAjax?g.reload().then(function(){g.sxc=g.sxc.recreate(),g.sxc.manage.toolbar._processToolbars()}):window.location.reload()},reload:function(a){return a||(a=g.templateId),a?b.reloadWithAjax?(g.templateId=a,g._getPreviewWithTemplate(a).then(g.replace)):window.location.reload():null},publish:function(a,b){return g.sxc.webApi.get({url:"view/module/publish",params:{part:a,sortOrder:b}}).then(g.reload)},removeFromList:function(a){return g.sxc.webApi.get({url:"view/module/removefromlist",params:{sortOrder:a}}).then(g.reload)},changeOrder:function(a,b){return g.sxc.webApi.get({url:"view/module/changeorder",params:{sortOrder:a,destinationSortOrder:b}}).then(g.reload)},addItem:function(a){return g.sxc.webApi.get({url:"View/Module/AddItem",params:{sortOrder:a}}).then(g.reload)},_getPreviewWithTemplate:function(a){return g.sxc.webApi.get({url:"view/module/rendertemplate",params:{templateId:a,lang:g.editContext.Language.Current,cbisentity:e.ContentBlock.IsEntity,cbid:e.ContentBlock.Id},dataType:"html"})},_setTemplateChooserState:function(a){return g.sxc.webApi.get({url:"view/module/SetTemplateChooserState",params:{state:a}})},_saveTemplate:function(a,b,c){return g.sxc.webApi.get({url:"view/module/savetemplateid",params:{templateId:a,forceCreateContentGroup:b,newTemplateChooserState:c}})},_cancelTemplateChange:function(){g.templateId=g.undoTemplateId,g.contentTypeId=g.undoContentTypeId,a.manage.dialog.justHide(),g._setTemplateChooserState(!1).then(g.reloadAndReInitialize)},dialogToggle:function(){var a=b.dialog;a?a.toggle():a=b.dialog=b.action({action:"dash-view"});var c=a.isVisible();b.editContext.ContentBlock.ShowTemplatePicker!==c&&g._setTemplateChooserState(c).then(function(){b.editContext.ContentBlock.ShowTemplatePicker=c})},prepareToAddContent:function(){return g.persistTemplate(!0,!1)},persistTemplate:function(a,c){var d,e=!!g.editContext.ContentGroup.HasContent&&g.undoTemplateId===g.templateId;d=e?g.editContext.ContentBlock.ShowTemplatePicker?g._setTemplateChooserState(!1):$.when(null):g._saveTemplate(g.templateId,a,c).then(function(a,c,d){if(200!==d.status)return void alert("error - result not ok, was not able to create ContentGroup");var e=a;e&&(e=e.replace(/[\",\']/g,""),console&&console.log("created content group {"+e+"}"),b.updateContentGroupGuid(e))});var f=d.then(function(){g.undoTemplateId=g.templateId,g.undoContentTypeId=g.contentTypeId,g.editContext.ContentBlock.ShowTemplatePicker=!1,b.dialog&&b.dialog.justHide(),g.editContext.ContentGroup.HasContent||(g.editContext.ContentGroup.HasContent=a),!e&&b.reloadWithAjax&&g.reloadAndReInitialize()});return f}};return g};var newBlockMenu=$("<div style='position:absolute; background:yellow; height: 30px; margin-top:-15px; opacity:0.5'><a>Add Content</a><a>Add app</a></div>");$("body").append(newBlockMenu),$("body").on("mousemove",function(a){var b=null;$(".sc-content-block").each(function(){var c=$(this),d=c.offset().left,e=c.width(),f=c.offset().top,g=(c.height(),a.clientX+$(window).scrollLeft()),h=a.clientY+$(window).scrollTop();d>g||h>d+e||Math.abs(h-f)<100&&(b=newBlockMenu.css({left:d,top:f,width:e}).show())}),null===b&&newBlockMenu.hide()}),function(){function a(a){return $("div[data-cb-id='"+a.cbid+"']")[0]}function b(a){var b=a.getAttribute("data-edit-context");return $.parseJSON(b||"")}$2sxc.getManageController=function(c){var d=a(c),e=b(d),f={zoneId:e.ContentGroup.ZoneId,appId:e.ContentGroup.AppId,tid:e.Environment.PageId,mid:e.Environment.InstanceId,cbid:c.cbid,lang:e.Language.Current,langpri:e.Language.Primary,langs:JSON.stringify(e.Language.All),portalroot:e.Environment.WebsiteUrl,websiteroot:e.Environment.SxcRootUrl,user:{canDesign:e.User.CanDesign,canDevelop:e.User.CanDesign},approot:e.ContentGroup.AppUrl||null},g={appId:e.ContentGroup.AppId,isContent:e.ContentGroup.IsContent,hasContent:e.ContentGroup.HasContent,isList:e.ContentGroup.IsList,templateId:e.ContentGroup.TemplateId,contentTypeId:e.ContentGroup.ContentTypeName,templateChooserVisible:e.ContentBlock.ShowTemplatePicker,user:{canDesign:e.User.CanDesign,canDevelop:e.User.CanDesign}},h=$2sxc._toolbarManager(c,e),i=$2sxc._contentManagementCommands(c,d),j={isEditMode:function(){return e.Environment.IsEditable},reloadWithAjax:e.ContentGroup.IsContent,dialogParameters:f,toolbarConfig:h.config,editContext:e,dashboardConfig:g,commands:i,action:i.executeAction,toolbar:h,getButton:h.getButton,createDefaultToolbar:h.createDefaultToolbar,getToolbar:h.getToolbar,init:function(){j.commands.init(j),j.contentBlock=$2sxc.contentBlock(c,j,d),e.ContentBlock.ShowTemplatePicker&&j.action({action:"layout"})},updateContentGroupGuid:function(a){e.ContentGroup.Guid=a,h.refreshConfig(),j.toolbarConfig=h.config},createContentBlock:function(a,b,d,e){var f=$("div[data-cbl-id='"+a+"'][data-cbl-field='"+b+"']");if(0===f.length)return alert("can't add content-block as we couldn't find the list");var g=f.find("div.sc-content-block");return d>g.length&&(d=g.length),c.webApi.get({url:"view/module/generatecontentblock",params:{parentId:a,field:b,sortOrder:d,app:e}}).then(function(a){var b=$(a);g.length>0&&d>0?$(g[g.length>d-1?d-1:g.length-1]).after(b):f.prepend(b);var c=$2sxc(b);c.manage.toolbar._processToolbars(b)})}};return j.init(),j}}(),$2sxc.translate=function(a){return a},function(){var a=$2sxc._dialog={mode:"iframe",templates:{inline:"<iframe width='100%' height='100px' src='{{url}}'onresize=\"console.log('resize')\"></iframe>"}};a.create=function(b,c,d,e){var f=$(a.templates.inline.replace("{{url}}",d))[0];return f.closeCallback=e,f.sxc=b,f.getManageInfo=function(){return f.sxc.manage.dialogParameters},f.getAdditionalDashboardConfig=function(){return f.sxc.manage.dashboardConfig},f.getCommands=function(){return f.vm},f.syncHeight=function(){var a=f.contentDocument.body.offsetHeight;f.previousHeight!=a&&(window.diagBox=f,console.log("tried resize to "+a),f.height=a+"px",f.previousHeight=a)},f.addEventListener("load",function(){f.syncHeight(),window.setInterval(f.syncHeight,200)}),f.isVisible=function(){return"none"!==f.style.display},f.toggle=function(){f.style.display="none"===f.style.display?"":"none"},f.justHide=function(){f.style.display="none"},$(c).before(f),f}}();var $2sxcActionMenuMapper=function(a){return{changeLayoutOrContent:function(){$2sxc(a).manage.action({action:"layout"})},addItem:function(){$2sxc(a).manage.action({action:"add",useModuleList:!0,sortOrder:0})},edit:function(){$2sxc(a).manage.action({action:"edit",useModuleList:!0,sortOrder:0})},adminApp:function(){$2sxc(a).manage.action({action:"app"})},adminZone:function(){$2sxc(a).manage.action({action:"zone"})},develop:function(){$2sxc(a).manage.action({action:"develop"})}}};$(document).ready(function(){$(".sc-menu").click(function(a){a.stopPropagation()});var a=$("div[data-edit-context]");console&&console.log("found "+a.length+" content blocks"),window.setTimeout(function(){a.each(function(){try{$2sxc(this).manage.toolbar._processToolbars(this)}catch(a){console&&console.error&&console.error(a)}})},0),window.EavEditDialogs=[]});
//# sourceMappingURL=inpage.min.js.map