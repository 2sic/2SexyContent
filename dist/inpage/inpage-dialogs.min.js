function processInstallMessage(a,b,c,d){var e=/^(http|https):\/\/((gettingstarted|[a-z]*)\.)?(2sexycontent|2sxc)\.org(\/.*)?$/gi;if(!e.test(a.origin))return void console.error("can't execute, wrong source domain");var f=JSON.parse(a.data);if(b=Number(b),f.moduleId===b)if("install"===f.action){for(var g=f.packages,h="",i=0;i<g.length;i++)h+="- "+g[i].displayName+"\n";confirm("Do you want to install these packages?\n\n"+h+"\nThis could take 10 to 60 seconds per package, please don't reload the page while it's installing. You will see a message once it's done and progess is logged to the JS-console.")&&(c.show=!0,c.label=".....",runOneInstallJob(g,0,c,d))}else"resize"===f.action&&resizeIFrame(b,f.height)}function resizeIFrame(a,b){document.getElementById("frGettingStarted").style.height=b+10+"px"}function runOneInstallJob(a,b,c,d){var e=a[b];return console.log(e.displayName+"("+b+") started"),c.label=e.displayName,d.get("app/installer/installpackage",{params:{packageUrl:e.url}}).then(function(f){console.log(e.displayName+"("+b+") completed"),b+1<a.length?runOneInstallJob(a,b+1,c,d):(alert("Done installing. If you saw no errors, everything worked."),window.top.location.reload())},function(a){var b="Something went wrong while installing '"+e.displayName+"': "+status;if(a.responseText&&""!==a.responseText){var c=JSON.parse(a.responseText);c.messages?b=b+" - "+c.messages[0].Message:c.Message&&(b=b+" - "+c.Message)}b+=" (you might find more informations about the error in the DNN event log).",alert(b)})}angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("template-selector/template-selector.html",'<div class=sc-selectors-wrapper><div class=sc-selectors><div ng-show=!vm.isContentApp style=overflow:hidden><select ng-model=vm.appId class="sc-selector-app input-lg pull-left" ng-options="a.AppId as (a.Name.indexOf(\'TemplatePicker.\') === 0 ? \'[+] \' + (a.Name | translate) : a.Name) for a in vm.apps" ng-disabled="vm.dashInfo.hasContent || vm.dashInfo.isList"><option value="" ng-disabled="vm.appId != null" translate=TemplatePicker.AppPickerDefault></option></select><span><span ng-if="vm.showAdvanced && !vm.isContentApp"><button type=button class="btn btn-default" ng-show="vm.appId != null" ng-click=vm.appSettings(); title="{{ \'TemplatePicker.App\' | translate }}"><i class=eav-icon-settings></i></button> <button type=button class="btn btn-default" ng-click=vm.appImport(); title="{{ \'TemplatePicker.Install\' | translate }}"><i class=eav-icon-plus></i></button> <button type=button class="btn btn-default" ng-click=vm.appStore(); title="{{ \'TemplatePicker.Catalog\' | translate }}"><i class=eav-icon-cart-arrow-down></i></button> <button type=button class="btn btn-default" ng-click=vm.manageApps(); title="{{ \'TemplatePicker.Zone\' | translate }}"><i class=eav-icon-manage></i></button></span></span></div><select ng-show=vm.isContentApp ng-model=vm.contentTypeId class=input-lg ng-options="c.StaticName as c.Name for c in vm.contentTypes" ng-disabled="vm.dashInfo.hasContent || vm.dashInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><div><select ng-show="vm.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null)" x="( && vm.filteredTemplates().length > 1)" ng-disabled="vm.filteredTemplates().length <= 1" class="input-lg pull-left" ng-model=vm.templateId ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select><button ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" class="btn btn-primary" ng-click="vm.persistTemplate(false, false);" title="{{ \'TemplatePicker.Save\' | translate }}" type=button><i class=eav-icon-ok></i></button> <button ng-show="vm.undoTemplateId != null" class="btn btn-default" ng-click=vm.cancelTemplateChange(); type=button title="{{ \'TemplatePicker.\' + (vm.isContentApp ? \'Cancel\' : \'Close\') | translate }}"><i class=eav-icon-cancel></i></button></div></div><div class=sc-loading ng-show=vm.loading><i class="eav-icon-spinner animate-spin"></i></div><div style="position: relative" ng-if=vm.showRemoteInstaller><iframe id=frGettingStarted ng-src={{vm.remoteInstallerUrl}} width=100% height=300px></iframe><div class=sc-loading id=pnlLoading ng-if=vm.progressIndicator.show><i class="eav-icon-spinner animate-spin"></i><br><br><span class=sc-loading-label>installing <span id=packageName>{{vm.progressIndicator.label}}</span></span></div></div></div>')}]),function(){angular.module("2sxc.view",["2sxc4ng","EavAdminUi","pascalprecht.translate","SxcInpageTemplates","EavConfiguration","ui.bootstrap"]).config(["$translatePartialLoaderProvider",function(a){a.addPart("sxc-admin")}])}(),function(){var a=angular.module("2sxc.view");a.factory("moduleApiService",["$http",function(a){return{getSelectableApps:function(){return a.get("View/Module/GetSelectableApps")},setAppId:function(b){return a.get("View/Module/SetAppId",{params:{appId:b}})},getSelectableContentTypes:function(){return a.get("View/Module/GetSelectableContentTypes")},getSelectableTemplates:function(){return a.get("View/Module/GetSelectableTemplates")},gettingStartedUrl:function(){return a.get("View/Module/RemoteInstallDialogUrl",{params:{dialog:"gettingstarted"}})}}}])}(),function(){var a=angular.module("2sxc.view");a.factory("contentBlockLink",function(){return function(a){var b=window.frameElement;return b.vm=a,{dialogContainer:b,window:window.parent,sxc:b.sxc,contentBlock:b.sxc.manage.contentBlock,dashInfo:b.getAdditionalDashboardConfig}}}),a.controller("TemplateSelectorCtrl",["$scope","$interval","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate","$sce","contentBlockLink","$http",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){r.progressIndicator.updater=b(function(){},200)}var n="_LayoutElement",o=-1,p=a,q=c,r=this;r.apps=[],r.contentTypes=[],r.templates=[];var s=k(r),t=r.dashInfo=s.dashInfo();r.isContentApp=t.isContent,r.supportsAjax=r.isContentApp||t.supportsAjax,r.showAdvanced=t.user.canDesign,r.templateId=t.templateId,r.undoTemplateId=t.templateId,r.contentTypeId=t.contentTypeId,r.undoContentTypeId=r.contentTypeId,r.appId=0!==r.dashInfo.appId?r.dashInfo.appId:null,r.savedAppId=r.dashInfo.appId,r.showRemoteInstaller=!1,r.remoteInstallerUrl="",r.loading=0,r.progressIndicator={show:!1,label:"..."},r.filteredTemplates=function(a){if(!r.isContentApp)return r.templates;var b={ContentTypeStaticName:a===n?"":a};return f("filter")(r.templates,b,!0)},r.reloadTemplates=function(){r.loading++;var a=q.getSelectableContentTypes(),b=q.getSelectableTemplates();return g.all([a,b]).then(function(a){r.contentTypes=a[0].data||[],r.templates=a[1].data||[],f("filter")(r.templates,{ContentTypeStaticName:""},!0).length>0&&(r.contentTypes.push({StaticName:n,Name:i.instant("TemplatePicker.LayoutElement")}),r.contentTypes=f("orderBy")(r.contentTypes,"Name")),r.loading--})},p.$watch("vm.templateId",function(a,b){if(a!==b){if(r.supportsAjax)return r.renderTemplate(a);s.contentBlock.templateId=r.templateId,r.persistTemplate(!1).then(function(){return s.window.location.reload()})}}),p.$watch("vm.contentTypeId",function(a,b){if(a!==b){var c=r.filteredTemplates(a)[0].TemplateId;r.templateId!==c&&null!==c&&(r.templateId=c)}}),p.$watch("vm.appId",function(a,b){if(a!==b&&null!==a){if(a===o)return r.appImport();var c=f("filter")(r.apps,{AppId:a})[0];q.setAppId(a).then(function(){c.SupportsAjaxReload?r.reInitAll(!0):s.window.location.reload()})}}),r.manageApps=function(){s.sxc.manage.action({action:"zone"})},r.appSettings=function(){s.sxc.manage.action({action:"app"})},r.appImport=function(){s.sxc.manage.action({action:"app-import"})},r.cancelTemplateChange=s.contentBlock._cancelTemplateChange,r.persistTemplate=s.contentBlock.persistTemplate,r.renderTemplate=s.contentBlock.reload,r.reInitAll=s.contentBlock.reloadAndReInitialize,r.appStore=function(){window.open("http://2sxc.org/en/apps")},r.show=function(a){if(void 0!==a&&(r.dashInfo.templateChooserVisible=a),r.dashInfo.templateChooserVisible){var b=[];null!==r.appId&&b.push(r.reloadTemplates()),r.isContentApp||0!==r.apps.length||b.push(r.loadApps()),g.all(b).then(r.externalInstaller.showIfConfigIsEmpty)}},r.externalInstaller={showIfConfigIsEmpty:function(){var a=r.isContentApp?0===r.templates.length:0===r.appCount;a&&r.externalInstaller.setup()},configureCallback:function(){window.addEventListener("message",function(a){processInstallMessage(a,d,r.progressIndicator,l)},!1)},setup:function(){q.gettingStartedUrl().then(function(a){a.data&&(r.externalInstaller.configureCallback(),r.showRemoteInstaller=!0,m(),r.remoteInstallerUrl=j.trustAsResourceUrl(a.data),console.log(a.data))})}},r.toggle=function(){r.dashInfo.templateChooserVisible?r.cancelTemplateChange():r.show(!0)},r.loadApps=function(){return q.getSelectableApps().then(function(a){r.apps=a.data,r.appCount=a.data.length,r.showAdvanced&&r.apps.push({Name:"TemplatePicker.Install",AppId:o})})},r.activate=function(){r.show(!0)},r.activate()}])}();
//# sourceMappingURL=inpage-dialogs.min.js.map