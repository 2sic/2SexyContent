function processInstallMessage(a,b){var c=/^(http|https):\/\/((gettingstarted|[a-z]*)\.)?(2sexycontent|2sxc)\.org(\/.*)?$/gi;if(!c.test(a.origin))return void console.error("can't execute, wrong source domain");var d=JSON.parse(a.data);if(d.moduleId===b)if("install"===d.action){for(var e=$.ServicesFramework(b),f=d.packages,g="",h=0;h<f.length;h++)g+="- "+f[h].displayName+"\n";if(confirm("Do you want to install these packages?\n\n"+g+"\nThis could take 10 to 60 seconds per package, please don't reload the page while it's installing. You will see a message once it's done and progess is logged to the JS-console.")){$(".DnnModule-"+b+" #pnlLoading").show();var i=$(".DnnModule-"+b+" #packageName");i.html("..."),runOneInstallJob(f,0,e,i)}}else"resize"===d.action&&resizeIFrame(b,d.height)}function resizeIFrame(a,b){$(".DnnModule-"+a+" #frGettingStarted").height(b)}function runOneInstallJob(a,b,c,d){var e=a[b];return console.log(e.displayName+"("+b+") started"),d.html(e.displayName),$.ajax({type:"GET",dataType:"json",async:!0,url:c.getServiceRoot("2sxc")+"Installer/InstallPackage",data:"packageUrl="+e.url,beforeSend:c.setModuleHeaders}).complete(function(f,g){console.log(e.displayName+"("+b+") completed"),b+1<a.length?runOneInstallJob(a,b+1,c,d):(alert("Done installing. If you saw no errors, everything worked."),window.location.reload())}).error(function(a,b,c){var d="Something went wrong while installing '"+e.displayName+"': "+c;if(a.responseText&&""!==a.responseText){var f=$.parseJSON(a.responseText);f.messages?d=d+" - "+f.messages[0].Message:f.Message&&(d=d+" - "+f.Message)}d+=" (you might find more informations about the error in the DNN event log).",alert(d)})}angular.module("SxcInpageTemplates",[]).run(["$templateCache",function(a){"use strict";a.put("template-selector/template-selector.html",'<div ng-cloak xng-show=vm.manageInfo.templateChooserVisible class="dnnFormMessage dnnFormInfo"><div class=sc-selectors><div ng-show=!vm.manageInfo.isContentApp><select ng-model=vm.appId class=sc-selector-app ng-options="a.AppId as (a.Name.indexOf(\'TemplatePicker.\') === 0 ? \'[+] \' + (a.Name | translate) : a.Name) for a in vm.apps" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option value="" ng-disabled="vm.appId != null" translate=TemplatePicker.AppPickerDefault></option></select></div><select ng-show=vm.manageInfo.isContentApp ng-model=vm.contentTypeId class=sc-selector-contenttype ng-options="c.StaticName as c.Name for c in vm.contentTypes" ng-disabled="vm.manageInfo.hasContent || vm.manageInfo.isList"><option ng-disabled="vm.contentTypeId != \'\'" value="" translate=TemplatePicker.ContentTypePickerDefault></option></select><select ng-show="vm.manageInfo.isContentApp ? vm.contentTypeId != 0 : (vm.savedAppId != null &&  vm.filteredTemplates().length > 1)" ng-model=vm.templateId class=sc-selector-template ng-options="t.TemplateId as t.Name for t in vm.filteredTemplates(vm.contentTypeId)"></select></div><div class=sc-selector-app-actions><span ng-if="vm.showAdvanced && !vm.manageInfo.isContentApp"><a class=sc-selector-save ng-if="vm.appId != null" ng-click=vm.appSettings(); title="{{ \'Toolbar.App\' | translate }}"><span><i class=icon-sxc-settings></i></span></a> <a class=sc-selector-save ng-click=vm.installApp(); title="{{ \'TemplatePicker.GetMoreApps\' | translate }}"><span><i class=icon-sxc-plus></i></span></a> <a class=sc-selector-save ng-click=vm.manageApps(); title="{{ \'Toolbar.Zone\' | translate }}"><span><i class=icon-sxc-manage></i></span></a></span></div><div class=sc-selector-actions><a ng-show="vm.templateId != null && vm.savedTemplateId != vm.templateId" class=sc-selector-save ng-click="vm.persistTemplate(false, false);" title="{{ \'TemplatePicker.Save\' | translate }}"><span><i class=icon-sxc-ok></i></span></a> <a ng-show="vm.undoTemplateId != null" class=sc-selector-close ng-click=vm.cancelTemplateChange(); title="{{ \'TemplatePicker.\' + (vm.manageInfo.isContentApp ? \'Cancel\' : \'Close\') | translate }}"><span><i class=icon-sxc-cancel></i></span></a></div><div class=sc-loading ng-show=vm.loading><i class="icon-sxc-spinner fa-spin"></i></div><div style="position: relative" ng-if=vm.showRemoteInstaller><iframe id=frGettingStarted ng-src={{vm.remoteInstallerUrl}} width=100% height=300px></iframe><div class=sc-loading id=pnlLoading style=display:none><i class="icon-sxc-spinner animate-spin"></i><br><br><span class=sc-loading-label>installing <span id=packageName>.</span></span></div></div></div>')}]),function(){var a=angular.module("2sxc.view",["2sxc4ng","pascalprecht.translate","SxcInpageTemplates","EavConfiguration"]);a.config(["$translateProvider","AppInstanceId","$translatePartialLoaderProvider","languages",function(a,b,c,d){a.preferredLanguage(d.currentLanguage.split("-")[0]).useSanitizeValueStrategy("escapeParameters").fallbackLanguage(d.fallbackLanguage).useLoader("$translatePartialLoader",{urlTemplate:d.i18nRoot+"{part}-{lang}.js"}).useLoaderCache(!0),c.addPart("inpage")}])}(),function(){var a=angular.module("2sxc.view");a.factory("moduleApiService",["$http",function(a){return{saveTemplate:function(b,c,d){return a.get("View/Module/SaveTemplateId",{params:{templateId:b,forceCreateContentGroup:c,newTemplateChooserState:d}})},addItem:function(b){return a.get("View/Module/AddItem",{params:{sortOrder:b}})},getSelectableApps:function(){return a.get("View/Module/GetSelectableApps")},setAppId:function(b){return a.get("View/Module/SetAppId",{params:{appId:b}})},getSelectableContentTypes:function(){return a.get("View/Module/GetSelectableContentTypes")},getSelectableTemplates:function(){return a.get("View/Module/GetSelectableTemplates")},setTemplateChooserState:function(b){return a.get("View/Module/SetTemplateChooserState",{params:{state:b}})},renderTemplate:function(b,c){return a.get("View/Module/RenderTemplate",{params:{templateId:b,lang:c}})},changeOrder:function(b,c){return a.get("View/Module/ChangeOrder",{params:{sortOrder:b,destinationSortOrder:c}})},publish:function(b,c){return a.get("view/module/publish",{params:{part:b,sortOrder:c}})},removeFromList:function(b){return a.get("View/Module/RemoveFromList",{params:{sortOrder:b}})},gettingStartedUrl:function(){return a.get("View/Module/RemoteInstallDialogUrl",{params:{dialog:"gettingstarted"}})}}}])}(),function(){var a=angular.module("2sxc.view");a.factory("inpageElement",function(){return function(a){var b=window.frameElement;b&&(b.vm=a);return{dialogContainer:b,getManageInfo:b?b.getManageInfo:null,replaceContent:b?b.replaceContent:null}}}),a.controller("TemplateSelectorCtrl",["$scope","moduleApiService","AppInstanceId","sxc","$filter","$q","$window","$translate","$sce","inpageElement",function(a,b,c,d,e,f,g,h,i,j){var k="_LayoutElement",l=-1,m=a,n=b,o=null,p=this;p.apps=[],p.contentTypes=[],p.templates=[];var q=j(p);p.manageInfo=d.manage?d.manage._manageInfo:q.getManageInfo(),p.showAdvanced=p.manageInfo.user.canDesign,p.templateId=p.manageInfo.templateId,p.undoTemplateId=p.templateId,p.contentTypeId=""===p.manageInfo.contentTypeId&&null!==p.manageInfo.templateId?k:p.manageInfo.contentTypeId,p.undoContentTypeId=p.contentTypeId,p.appId=p.manageInfo.appId,p.savedAppId=p.manageInfo.appId,p.showRemoteInstaller=!1,p.remoteInstallerUrl="",p.loading=0,p.filteredTemplates=function(a){if(!p.manageInfo.isContentApp)return p.templates;var b={ContentTypeStaticName:a===k?"":a};return e("filter")(p.templates,b,!0)},p.reloadTemplates=function(){p.loading++;var a=n.getSelectableContentTypes(),b=n.getSelectableTemplates();return f.all([a,b]).then(function(a){p.contentTypes=a[0].data,p.templates=a[1].data,e("filter")(p.templates,{ContentTypeStaticName:""},!0).length>0&&(p.contentTypes.push({StaticName:k,Name:h.instant("TemplatePicker.LayoutElement")}),p.contentTypes=e("orderBy")(p.contentTypes,"Name")),p.loading--})},m.$watch("vm.templateId",function(a,b){if(a!==b){if(p.manageInfo.isContentApp)return p.renderTemplate(a);p.loading++,p.persistTemplate(!1).then(function(){g.location.reload()})}}),m.$watch("vm.contentTypeId",function(a,b){if(a!=b){var c=p.filteredTemplates(a)[0].TemplateId;p.templateId!==c&&null!==c&&(p.templateId=c)}}),m.$watch("vm.appId",function(a,b){return a!==b&&null!==a?a===l?void(window.location=o):void n.setAppId(a).then(function(){g.location.reload()}):void 0}),p.manageApps=function(){d.manage.action({action:"zone"})},p.appSettings=function(){d.manage.action({action:"app"})},p.installApp=function(){window.location=o},p.cancelTemplateChange=function(){p.templateId=p.undoTemplateId,p.contentTypeId=p.undoContentTypeId,p.manageInfo.templateChooserVisible=!1,n.setTemplateChooserState(!1),p.manageInfo.isContentApp&&p.reloadTemplates()},p.persistTemplate=function(a,b){var c,e=!!p.manageInfo.hasContent&&p.undoTemplateId===p.templateId;c=e?p.manageInfo.templateChooserVisible?n.setTemplateChooserState(!1):f.when(null):n.saveTemplate(p.templateId,a,b).then(function(a){if(200!==a.status)return void alert("error - result not ok, was not able to create ContentGroup");var b=a.data;null!==b&&(b=b.replace(/[\",\']/g,""),console&&console.log("created content group {"+b+"}"),d.manage._manageInfo.config.contentGroupId=b)});var g=c.then(function(){p.undoTemplateId=p.templateId,p.undoContentTypeId=p.contentTypeId,p.manageInfo.templateChooserVisible=!1,p.manageInfo.hasContent||(p.manageInfo.hasContent=a)});return g},p.renderTemplate=function(a){p.loading++,n.renderTemplate(a,p.manageInfo.lang).then(function(a){try{q.replaceContent(a.data)}catch(b){console.log("Error while rendering template:"),console.log(b)}p.loading--})},p.show=function(a){if(void 0!==a&&(p.manageInfo.templateChooserVisible=a),p.manageInfo.templateChooserVisible){var b=[];null!==p.appId&&b.push(p.reloadTemplates()),p.manageInfo.isContentApp||0!==p.apps.length||b.push(p.loadApps()),f.all(b).then(p.externalInstaller.showIfConfigIsEmpty)}},p.externalInstaller={showIfConfigIsEmpty:function(){var a=p.manageInfo.isContentApp?0===p.templates.length:0===p.appCount;a&&p.externalInstaller.setup()},configureCallback:function(){window.addEventListener("message",function(a){processInstallMessage(a,c)},!1)},setup:function(){n.gettingStartedUrl().then(function(a){p.externalInstaller.configureCallback(),p.showRemoteInstaller=!0,p.remoteInstallerUrl=i.trustAsResourceUrl(a.data),console.log(a.data)})}},p.toggle=function(){p.manageInfo.someTest="a value",p.manageInfo.templateChooserVisible?p.cancelTemplateChange():(p.show(!0),n.setTemplateChooserState(!0))},p.reload=function(){p.templateId&&(p.manageInfo.isContentApp?p.renderTemplate(p.templateId):g.location.reload())},p.loadApps=function(){return n.getSelectableApps().then(function(a){p.apps=a.data,p.appCount=a.data.length})},p.activate=function(){p.show()},p.activate(),p.prepareToAddContent=function(){return p.persistTemplate(!0,!1)},p.addItem=function(a){n.addItem(a).then(function(){p.renderTemplate(p.templateId)})},p.removeFromList=function(a){n.removeFromList(a).then(function(){p.renderTemplate(p.templateId)})},p.reallyDelete=function(a){alert("Really delete not implemented yet - would delete: "+a)},p.changeOrder=function(a,b){n.changeOrder(a,b).then(function(){p.renderTemplate(p.templateId)})},p.publish=function(a,b){n.publish(a,b).then(function(){p.renderTemplate(p.templateId)})},p.translate=function(a){return h.instant(a)}}])}();
//# sourceMappingURL=inpage-dialogs.min.js.map